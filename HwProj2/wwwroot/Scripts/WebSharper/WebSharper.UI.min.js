(function(){"use strict";var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,_0,_1,_2,_3,_4,_5,_6,_7,_8,_9,_,$,ba,bb,bc,bd,be,bf,bg,bh,bi,bj,bk,bl,bm,bn,bo,bp,bq,br,bs,bt,bu,bv,bw,bx,by,bz,bA,bB,bC,bD,bE,bF,bG,bH,bI,bJ,bK,bL,bM,bN,bO,bP,bQ,bR,bS,bT,bU;a=window;b=a.WebSharper=a.WebSharper||{};c=b.UI=b.UI||{};d=c.Array=c.Array||{};e=c.String=c.String||{};f=c.List=c.List||{};g=c.Abbrev=c.Abbrev||{};h=g.Fresh=g.Fresh||{};i=g.HashSet=g.HashSet||{};j=g.Dict=g.Dict||{};k=b&&b.Obj;l=g.Slot=g.Slot||{};m=g.Async=g.Async||{};n=g.Mailbox=g.Mailbox||{};o=a.StartupCode$WebSharper_UI$Abbrev=a.StartupCode$WebSharper_UI$Abbrev||{};p=c.AppendList=c.AppendList||{};q=a.StartupCode$WebSharper_UI$AppendList=a.StartupCode$WebSharper_UI$AppendList||{};r=c.DomUtility=c.DomUtility||{};s=a.StartupCode$WebSharper_UI$DomUtility=a.StartupCode$WebSharper_UI$DomUtility||{};t=c.Trie=c.Trie||{};u=t.LookupResult=t.LookupResult||{};v=a.StartupCode$WebSharper_UI$Trie=a.StartupCode$WebSharper_UI$Trie||{};w=c.Snap=c.Snap||{};x=c.Var=c.Var||{};y=c.View=c.View||{};z=c.ConcreteVar=c.ConcreteVar||{};A=c.Updates=c.Updates||{};B=c.ViewBuilder=c.ViewBuilder||{};C=c.Submitter=c.Submitter||{};D=c.Key=c.Key||{};E=c.Model=c.Model||{};F=c.Serializer=c.Serializer||{};G=c.Storage=c.Storage||{};H=G.ArrayStorage=G.ArrayStorage||{};I=G.LocalStorageBackend=G.LocalStorageBackend||{};J=c.ListModel=c.ListModel||{};K=c.ListModels=c.ListModels||{};L=a.StartupCode$WebSharper_UI$Models=a.StartupCode$WebSharper_UI$Models||{};M=c.ReactiveExtensions=c.ReactiveExtensions||{};N=c.DoubleInterpolation=c.DoubleInterpolation||{};O=c.Interpolation=c.Interpolation||{};P=c.Easing=c.Easing||{};Q=c.Easings=c.Easings||{};R=c.An=c.An||{};S=c.Anims=c.Anims||{};T=c.Trans=c.Trans||{};U=a.StartupCode$WebSharper_UI$Animation=a.StartupCode$WebSharper_UI$Animation||{};V=c.AnimatedAttrNode=c.AnimatedAttrNode||{};W=c.DynamicAttrNode=c.DynamicAttrNode||{};X=c.AttrProxy=c.AttrProxy||{};Y=c.Client=c.Client||{};Z=Y.Attrs=Y.Attrs||{};_0=Z.Dyn=Z.Dyn||{};_1=c.Attrs=c.Attrs||{};_2=c.CheckedInput=c.CheckedInput||{};_3=c.AttrModule=c.AttrModule||{};_4=a.StartupCode$WebSharper_UI$Attr_Client=a.StartupCode$WebSharper_UI$Attr_Client||{};_5=Y.Settings=Y.Settings||{};_6=c.DocElemNode=c.DocElemNode||{};_7=Y.Docs=Y.Docs||{};_8=_7.DomNodes=_7.DomNodes||{};_9=_7.NodeSet=_7.NodeSet||{};_=_7.RunState=_7.RunState||{};$=c.Docs=c.Docs||{};ba=c.Doc=c.Doc||{};bb=c.Elt=c.Elt||{};bc=Y.EltUpdater=Y.EltUpdater||{};bd=a.StartupCode$WebSharper_UI$Doc_Client=a.StartupCode$WebSharper_UI$Doc_Client||{};be=c.Flow=c.Flow||{};bf=c.FlowBuilder=c.FlowBuilder||{};bg=c.HtmlModule=c.HtmlModule||{};bh=bg.attr=bg.attr||{};bi=c.Router=c.Router||{};bj=c.Route=c.Route||{};bk=c.Routing=c.Routing||{};bl=c.RouteMap=c.RouteMap||{};bm=c.Input=c.Input||{};bn=bm.MousePosSt=bm.MousePosSt||{};bo=bm.MouseBtnSt=bm.MouseBtnSt||{};bp=bm.Mouse=bm.Mouse||{};bq=bm.KeyListenerSt=bm.KeyListenerSt||{};br=bm.Keyboard=bm.Keyboard||{};bs=a.StartupCode$WebSharper_UI$Input=a.StartupCode$WebSharper_UI$Input||{};bt=b&&b.List;bu=b&&b.Arrays;bv=b&&b.Enumerator;bw=b&&b.Strings;bx=b&&b.Char;by=b&&b.Collections;bz=by&&by.HashSet;bA=b&&b.Seq;bB=a.IntelliFactory;bC=bB&&bB.Runtime;bD=b&&b.Unchecked;bE=a.console;bF=b&&b.Concurrency;bG=by&&by.Map;bH=by&&by.FSharpMap;bI=b&&b.Operators;bJ=b&&b.Queue;bK=b&&b.Lazy;bL=by&&by.Dictionary;bM=a.JSON;bN=b&&b.Numeric;bO=a.Node;bP=a.jQuery;bQ=b&&b.Slice;bR=b&&b.Sitelets;bS=bR&&bR.RouterModule;bT=bR&&bR.Route;bU=b&&b.Utils;d.mapInPlace=function(bV,bW){var bX,bY;for(bX=0,bY=bW.length-1;bX<=bY;bX++)bW[bX]=bV(bW[bX]);return bW;};d.ofSeqNonCopying=function(bV){var bW,bX;if(bV instanceof a.Array)return bV;else if(bV instanceof bt.T)return bu.ofList(bV);else if(bV===null)return[];else{bW=[];bX=bv.Get(bV);try{while(bX.MoveNext())bW.push(bX.Current());return bW;}finally{if("Dispose"in bX)bX.Dispose();}}};d.MapTreeReduce=function(bV,bW,bX,bY){var bZ;function b0(b1,b2){var b3,b4;return b2<=0?bW:b2===1&&(b1>=0&&b1<bZ)?bV(bu.get(bY,b1)):(b4=b2/2>>0,bX(b0(b1,b4),b0(b1+b4,b2-b4)));}bZ=bu.length(bY);return b0(0,bZ);};d.TreeReduce=function(bV,bW,bX){var bY;function bZ(b0,b1){var b2,b3;return b1<=0?bV:b1===1&&(b0>=0&&b0<bY)?bu.get(bX,b0):(b3=b1/2>>0,bW(bZ(b0,b3),bZ(b0+b3,b1-b3)));}bY=bu.length(bX);return bZ(0,bY);};e.isBlank=function(bV){return bw.forall(bx.IsWhiteSpace,bV);};f.maybeReplaceFirst=function(bV,bW,bX){var bY;bY=[false];return bt.map(function(bZ){var b0;return!bY[0]&&bV(bZ)?(b0=bW(bZ),b0==null?bZ:b0.$0):bZ;},bX);};f.replaceFirst=function(bV,bW,bX){var bY;bY=[false];return bt.map(function(bZ){return!bY[0]&&bV(bZ)?bW(bZ):bZ;},bX);};h.Id=function(){h.set_counter(h.counter()+1);return"uid"+a.String(h.counter());};h.Int=function(){h.set_counter(h.counter()+1);return h.counter();};h.counter=function(){o.$cctor();return o.counter;};h.set_counter=function(bV){o.$cctor();o.counter=bV;};i.Filter=function(bV,bW){return new bz.New$2(bu.filter(bV,i.ToArray(bW)));};i.Intersect=function(bV,bW){var bX;bX=new bz.New$2(i.ToArray(bV));bX.IntersectWith(i.ToArray(bW));return bX;};i.Except=function(bV,bW){var bX;bX=new bz.New$2(i.ToArray(bW));bX.ExceptWith(i.ToArray(bV));return bX;};i.ToArray=function(bV){var bW;bW=bu.create(bV.get_Count(),void 0);bV.CopyTo(bW);return bW;};j.ToValueArray=function(bV){var bW;bW=bu.create(bV.count,void 0);bA.iteri(function(bX,bY){return bu.set(bW,bX,bY.V);},bV);return bW;};j.ToKeyArray=function(bV){var bW;bW=bu.create(bV.count,void 0);bA.iteri(function(bX,bY){return bu.set(bW,bX,bY.K);},bV);return bW;};l=g.Slot=bC.Class({GetHashCode:function(){return bD.Hash(this.key(this.value));},Equals:function(bV){return bD.Equals(this.key(this.value),this.key(bV.get_Value()));},get_Value:function(){return this.value;}},k,l);l.New=bC.Ctor(function(bV,bW){this.key=bV;this.value=bW;},l);l.Create=function(bV,bW){return new l.New(bV,bW);};m.OnError=function(bV){return bE.log("WebSharper UI: Uncaught asynchronous exception",bV);};m.StartTo=function(bV,bW){bF.StartWithContinuations(bV,bW,function(bX){m.OnError(bX);},a.ignore,null);};n.StartProcessor=function(bV){var bW;function bX(){var bY;bY=null;return bF.Delay(function(){return bF.Bind(bV,function(){var bZ;bZ=bW[0];return bZ===1?(bW[0]=0,bF.Zero()):bZ===2?(bW[0]=1,bX()):bF.Zero();});});}bW=[0];return function(){var bY;bY=bW[0];bY===0?(bW[0]=1,bF.Start(bX(),null)):bY===1?bW[0]=2:void 0;};};o.$cctor=function(){o.$cctor=a.ignore;o.counter=0;};p.FromArray=function(bV){var bW;bW=bV.length;return bW===0?{$:0}:bW===1?{$:1,$0:bu.get(bV,0)}:{$:3,$0:bV.slice()};};p.ToArray=function(bV){var bW;function bX(bY){if(bY.$==1)bW.push(bY.$0);else if(bY.$==2){bX(bY.$0);bX(bY.$1);}else if(bY.$==3)bu.iter(function(bZ){bW.push(bZ);},bY.$0);}bW=[];bX(bV);return bW.slice(0);};p.Single=function(bV){return{$:1,$0:bV};};p.Concat=function(bV){var bW;bW=d.ofSeqNonCopying(bV);return d.TreeReduce(p.Empty(),p.Append,bW);};p.Append=function(bV,bW){return bV.$==0?bW:bW.$==0?bV:{$:2,$0:bV,$1:bW};};p.Empty=function(){q.$cctor();return q.Empty;};q.$cctor=function(){q.$cctor=a.ignore;q.Empty={$:0};};r.SetProperty=function(bV,bW,bX){return bV.setProperty(bW,bX);};r.IterSelector=function(bV,bW,bX){var bY,bZ,b0;bY=bV.querySelectorAll(bW);for(bZ=0,b0=bY.length-1;bZ<=b0;bZ++)bX(bY[bZ]);};r.ChildrenArray=function(bV){var bW,bX,bY;bW=[];for(bX=0,bY=bV.childNodes.length-1;bX<=bY;bX++)bW.push(bV.childNodes[bX]);return bW;};r.RemoveClass=function(bV,bW){a.jQuery(bV).removeClass(bW);};r.AddClass=function(bV,bW){a.jQuery(bV).addClass(bW);};r.InsertAt=function(bV,bW,bX){var bY;if(!(bX.parentNode===bV&&bW===(bY=bX.nextSibling,bD.Equals(bY,null)?null:bY)))bV.insertBefore(bX,bW);};r.RemoveNode=function(bV,bW){if(bW.parentNode===bV)bV.removeChild(bW);};r.SetStyle=function(bV,bW,bX){r.SetProperty(bV.style,bW,bX);};r.SetAttr=function(bV,bW,bX){bV.setAttribute(bW,bX);};r.RemoveAttr=function(bV,bW){bV.removeAttribute(bW);};r.CreateAttr=function(bV,bW){var bX;bX=r.Doc().createAttribute(bV);bX.value=bW;return bX;};r.CreateText=function(bV){return r.Doc().createTextNode(bV);};r.CreateSvgElement=function(bV){return r.Doc().createElementNS("http://www.w3.org/2000/svg",bV);};r.CreateElement=function(bV){return r.Doc().createElement(bV);};r.Clear=function(bV){while(bV.hasChildNodes())bV.removeChild(bV.firstChild);};r.ClearAttrs=function(bV){while(bV.hasAttributes())bV.removeAttributeNode(bV.attributes.item(0));};r.AppendTo=function(bV,bW){bV.appendChild(bW);};r.Doc=function(){s.$cctor();return s.Doc;};s.$cctor=function(){s.$cctor=a.ignore;s.Doc=a.document;};u.NotFound={$:1};t.Empty=function(){v.$cctor();return v.Empty;};t.Lookup=function(bV,bW){return t.Look(bt.ofSeq(bW),bV);};t.Look=function(bV,bW){var bX,bY;switch(bW.$==2?(bX=bW.$0,0):bW.$==0?bV.$==1?(bX=[bV.$0,bV.$1,bW.$0],1):2:2){case 0:return{$:0,$0:bX,$1:bV};break;case 1:bY=bG.TryFind(bX[0],bX[2]);return bY==null?u.NotFound:t.Look(bX[1],bY.$0);break;case 2:return u.NotFound;break;}};t.ToArray=function(bV){var bW;bW=[];t.Map(function(){return function(bX){return bW.push(bX);};},bV);return bW.slice(0);};t.Mapi=function(bV,bW){var bX;function bY(){var bZ;bZ=bX[0];bX[0]=bZ+1;return bZ;}bX=[0];return t.Map(function(bZ){return bV(bY(),bZ);},bW);};t.Map=function(bV,bW){return t.MapLoop(bt.T.Empty,bV,bW);};t.MapLoop=function(bV,bW,bX){return bX.$==1?{$:1}:bX.$==2?{$:2,$0:(bW(bV))(bX.$0)}:t.TrieBranch(bG.Map(function(bY,bZ){return t.MapLoop(bt.append(bV,bt.ofArray([bY])),bW,bZ);},bX.$0));};t.Merge=function(bV){var bW,bX,bY;bW=d.ofSeqNonCopying(bV);bX=bu.length(bW);return bX===0?{$:1,$0:{$:1}}:bX===1?{$:1,$0:bu.get(bW,0)}:bu.exists(t.IsLeaf,bW)?null:(bY=t.MergeMaps(t.Merge,bA.choose(function(bZ){return bZ.$==0?{$:1,$0:bZ.$0}:null;},bW)),bY==null?null:{$:1,$0:t.TrieBranch(bY.$0)});};t.IsLeaf=function(bV){return bV.$==2;};t.MergeMaps=function(bV,bW){var bX,bY;function bZ(b0,b1){var b2;b2=bV(b1);return b2==null?null:{$:1,$0:[b0,b2.$0]};}bX=t.AllSome(bA.map(function(b0){return bZ(b0[0],b0[1]);},bG.ToSeq((bY=bA.collect(bG.ToSeq,bW),bA.fold(function(b0,b1){return t.MultiAdd(b1[0],b1[1],b0);},new bH.New([]),bY)))));return bX==null?null:{$:1,$0:bG.OfArray(bu.ofSeq(bX.$0))};};t.AllSome=function(bV){var bW,bX,bY,bZ;bX=bv.Get(bV);bY=[];bW=true;while(bW&&bX.MoveNext()){bZ=bX.Current();bZ!=null&&bZ.$==1?bY.push(bZ.$0):bW=false;}return bW?{$:1,$0:bY.slice()}:null;};t.MultiAdd=function(bV,bW,bX){return bX.Add(bV,new bt.T({$:1,$0:bW,$1:t.MultiFind(bV,bX)}));};t.MultiFind=function(bV,bW){var bX;bX=bG.TryFind(bV,bW);return bX==null?bt.T.Empty:bX.$0;};t.Prefix=function(bV,bW){return t.TrieBranch(new bH.New(bt.ofArray([[bV,bW]])));};t.Leaf=function(bV){return{$:2,$0:bV};};t.TrieBranch=function(bV){return bV.get_IsEmpty()?{$:1}:{$:0,$0:bV};};v.$cctor=function(){v.$cctor=a.ignore;v.Empty={$:1};};w.Obsolete=function(bV){var bW,bX,bY,bZ,b0;bX=bV.s;if(bX==null||(bX!=null&&bX.$==2?(bW=bX.$1,false):bX!=null&&bX.$==3?(bW=bX.$1,false):true))void 0;else{bV.s=null;for(bY=0,bZ=bu.length(bW)-1;bY<=bZ;bY++){b0=bu.get(bW,bY);typeof b0=="object"?function(b1){w.Obsolete(b1);}(b0):b0();}}};w.New=function(bV){return{s:bV};};w.MapAsync=function(bV,bW){var bX;bX=w.New({$:3,$0:[],$1:[]});w.When(bW,function(bY){m.StartTo(bV(bY),function(bZ){w.MarkDone(bX,bW,bZ);});},bX);return bX;};w.SnapshotOn=function(bV,bW){var bX;function bY(bZ){var b0,b1,b2;if(!(b0=bX.s,b0!=null&&b0.$==0||b0!=null&&b0.$==2)){b1=w.ValueAndForever(bV);b2=w.ValueAndForever(bW);b1!=null&&b1.$==1?b2!=null&&b2.$==1?b1.$0[1]||b2.$0[1]?w.MarkForever(bX,b2.$0[0]):w.MarkReady(bX,b2.$0[0]):void 0:void 0;}}bX=w.New({$:3,$0:[],$1:[]});w.When(bV,bY,bX);w.WhenReady(bW,bY);return bX;};w.Map3=function(bV,bW,bX,bY){var bZ,b0,b1,b2;function b3(b4){var b5,b6,b7,b8;if(!(b5=b2.s,b5!=null&&b5.$==0||b5!=null&&b5.$==2)){b6=w.ValueAndForever(bW);b7=w.ValueAndForever(bX);b8=w.ValueAndForever(bY);b6!=null&&b6.$==1?b7!=null&&b7.$==1?b8!=null&&b8.$==1?b6.$0[1]&&b7.$0[1]&&b8.$0[1]?w.MarkForever(b2,bV(b6.$0[0],b7.$0[0],b8.$0[0])):w.MarkReady(b2,bV(b6.$0[0],b7.$0[0],b8.$0[0])):void 0:void 0:void 0;}}bZ=bW.s;b0=bX.s;b1=bY.s;return bZ!=null&&bZ.$==0?b0!=null&&b0.$==0?b1!=null&&b1.$==0?w.New({$:0,$0:bV(bZ.$0,b0.$0,b1.$0)}):w.Map3Opt1(bV,bZ.$0,b0.$0,bY):b1!=null&&b1.$==0?w.Map3Opt2(bV,bZ.$0,b1.$0,bX):w.Map3Opt3(bV,bZ.$0,bX,bY):b0!=null&&b0.$==0?b1!=null&&b1.$==0?w.Map3Opt4(bV,b0.$0,b1.$0,bW):w.Map3Opt5(bV,b0.$0,bW,bY):b1!=null&&b1.$==0?w.Map3Opt6(bV,b1.$0,bW,bX):(b2=w.New({$:3,$0:[],$1:[]}),(w.When(bW,b3,b2),w.When(bX,b3,b2),w.When(bY,b3,b2),b2));};w.Map3Opt6=function(bV,bW,bX,bY){return w.Map2(function(bZ,b0){return bV(bZ,b0,bW);},bX,bY);};w.Map3Opt5=function(bV,bW,bX,bY){return w.Map2(function(bZ,b0){return bV(bZ,bW,b0);},bX,bY);};w.Map3Opt4=function(bV,bW,bX,bY){return w.Map(function(bZ){return bV(bZ,bW,bX);},bY);};w.Map3Opt3=function(bV,bW,bX,bY){return w.Map2(function(bZ,b0){return bV(bW,bZ,b0);},bX,bY);};w.Map3Opt2=function(bV,bW,bX,bY){return w.Map(function(bZ){return bV(bW,bZ,bX);},bY);};w.Map3Opt1=function(bV,bW,bX,bY){return w.Map(function(bZ){return bV(bW,bX,bZ);},bY);};w.Map2Unit=function(bV,bW){var bX,bY,bZ;function b0(){var b1,b2,b3;if(!(b1=bZ.s,b1!=null&&b1.$==0||b1!=null&&b1.$==2)){b2=w.ValueAndForever(bV);b3=w.ValueAndForever(bW);b2!=null&&b2.$==1?b3!=null&&b3.$==1?b2.$0[1]&&b3.$0[1]?w.MarkForever(bZ,null):w.MarkReady(bZ,null):void 0:void 0;}}bX=bV.s;bY=bW.s;return bX!=null&&bX.$==0?bY!=null&&bY.$==0?w.New({$:0,$0:null}):bW:bY!=null&&bY.$==0?bV:(bZ=w.New({$:3,$0:[],$1:[]}),(w.When(bV,b0,bZ),w.When(bW,b0,bZ),bZ));};w.Map2=function(bV,bW,bX){var bY,bZ,b0;function b1(b2){var b3,b4,b5;if(!(b3=b0.s,b3!=null&&b3.$==0||b3!=null&&b3.$==2)){b4=w.ValueAndForever(bW);b5=w.ValueAndForever(bX);b4!=null&&b4.$==1?b5!=null&&b5.$==1?b4.$0[1]&&b5.$0[1]?w.MarkForever(b0,bV(b4.$0[0],b5.$0[0])):w.MarkReady(b0,bV(b4.$0[0],b5.$0[0])):void 0:void 0;}}bY=bW.s;bZ=bX.s;return bY!=null&&bY.$==0?bZ!=null&&bZ.$==0?w.New({$:0,$0:bV(bY.$0,bZ.$0)}):w.Map2Opt1(bV,bY.$0,bX):bZ!=null&&bZ.$==0?w.Map2Opt2(bV,bZ.$0,bW):(b0=w.New({$:3,$0:[],$1:[]}),(w.When(bW,b1,b0),w.When(bX,b1,b0),b0));};w.Map2Opt2=function(bV,bW,bX){return w.Map(function(bY){return bV(bY,bW);},bX);};w.Map2Opt1=function(bV,bW,bX){return w.Map(function(bY){return bV(bW,bY);},bX);};w.MapCachedBy=function(bV,bW,bX,bY){return w.Map(function(bZ){var b0,b1,b2;b0=bW[0];return b0!=null&&b0.$==1&&(bV(bZ,b0.$0[0])&&(b1=[b0.$0[0],b0.$0[1]],true))?b1[1]:(b2=bX(bZ),(bW[0]={$:1,$0:[bZ,b2]},b2));},bY);};w.Copy=function(bV){var bW,bX,bY;bW=bV.s;return bW==null?bV:bW!=null&&bW.$==2?(bX=w.New({$:2,$0:bW.$0,$1:[]}),(w.WhenObsolete(bV,bX),bX)):bW!=null&&bW.$==3?(bY=w.New({$:3,$0:[],$1:[]}),(w.When(bV,function(bZ){w.MarkDone(bY,bV,bZ);},bY),bY)):bV;};w.WithInitOption=function(bV){var bW,bX,bY;bW=bV.s;return bW==null?w.New(null):bW!=null&&bW.$==2?(bX=w.New({$:2,$0:{$:1,$0:bW.$0},$1:[]}),(w.WhenObsolete(bV,bX),bX)):bW!=null&&bW.$==3?(bY=w.New({$:2,$0:null,$1:[]}),(w.When(bV,function(){w.Obsolete(bY);},bY),bY)):w.New({$:0,$0:{$:1,$0:bW.$0}});};w.WithInit=function(bV,bW){var bX,bY,bZ;bX=bW.s;return bX==null?bW:bX!=null&&bX.$==2?(bY=w.New({$:2,$0:bX.$0,$1:[]}),(w.WhenObsolete(bW,bY),bY)):bX!=null&&bX.$==3?(bZ=w.New({$:2,$0:bV,$1:[]}),(w.When(bW,function(){w.Obsolete(bZ);},bZ),bZ)):bW;};w.Map=function(bV,bW){var bX,bY;bX=bW.s;return bX!=null&&bX.$==0?w.New({$:0,$0:bV(bX.$0)}):(bY=w.New({$:3,$0:[],$1:[]}),(w.When(bW,function(bZ){w.MarkDone(bY,bW,bV(bZ));},bY),bY));};w.Sequence=function(bV){var bW,bX,bY;function bZ(b0){var b1;if(bY[0]===0){b1=bu.map(function(b2){var b3;b3=b2.s;return b3!=null&&b3.$==0?b3.$0:b3!=null&&b3.$==2?b3.$0:bI.FailWith("value not found by View.Sequence");},bW);bu.forall(function(b2){var b3;b3=b2.s;return b3!=null&&b3.$==0;},bW)?w.MarkForever(bX,b1):w.MarkReady(bX,b1);}else bY[0]--;}bW=bu.ofSeq(bV);return bW.length==0?w.New({$:0,$0:[]}):(bX=w.New({$:3,$0:[],$1:[]}),(bY=[bu.length(bW)-1],(bu.iter(function(b0){w.When(b0,bZ,bX);},bW),bX)));};w.CreateForeverAsync=function(bV){var bW;bW=w.New({$:3,$0:[],$1:[]});m.StartTo(bV,function(bX){w.MarkForever(bW,bX);});return bW;};w.JoinInner=function(bV){var bW;bW=w.New({$:3,$0:[],$1:[]});w.When(bV,function(bX){var bY;bY=bX();w.When(bY,function(bZ){var b0,b1;if((b0=bY.s,b0!=null&&b0.$==0)&&(b1=bV.s,b1!=null&&b1.$==0))w.MarkForever(bW,bZ);else w.MarkReady(bW,bZ);},bW);w.WhenObsolete(bV,bY);},bW);return bW;};w.Join=function(bV){var bW;bW=w.New({$:3,$0:[],$1:[]});w.When(bV,function(bX){var bY;bY=bX();w.When(bY,function(bZ){var b0,b1;if((b0=bY.s,b0!=null&&b0.$==0)&&(b1=bV.s,b1!=null&&b1.$==0))w.MarkForever(bW,bZ);else w.MarkReady(bW,bZ);},bW);},bW);return bW;};w.ValueAndForever=function(bV){var bW;bW=bV.s;return bW!=null&&bW.$==0?{$:1,$0:[bW.$0,true]}:bW!=null&&bW.$==2?{$:1,$0:[bW.$0,false]}:null;};w.WhenObsoleteRun=function(bV,bW){var bX;bX=bV.s;bX==null?bW():bX!=null&&bX.$==2?bX.$1.push(bW):bX!=null&&bX.$==3?bX.$1.push(bW):void 0;};w.WhenObsolete=function(bV,bW){var bX;bX=bV.s;bX==null?w.Obsolete(bW):bX!=null&&bX.$==2?w.EnqueueSafe(bX.$1,bW):bX!=null&&bX.$==3?w.EnqueueSafe(bX.$1,bW):void 0;};w.WhenReady=function(bV,bW){var bX,bY;bY=bV.s;switch(bY!=null&&bY.$==2?(bX=bY.$0,0):bY==null?1:bY!=null&&bY.$==3?2:(bX=bY.$0,0)){case 0:bW(bX);break;case 1:null;break;case 2:bY.$0.push(bW);break;}};w.WhenRun=function(bV,bW,bX){var bY;bY=bV.s;bY==null?bX():bY!=null&&bY.$==2?(bY.$1.push(bX),bW(bY.$0)):bY!=null&&bY.$==3?(bY.$0.push(bW),bY.$1.push(bX)):bW(bY.$0);};w.When=function(bV,bW,bX){var bY;bY=bV.s;bY==null?w.Obsolete(bX):bY!=null&&bY.$==2?(w.EnqueueSafe(bY.$1,bX),bW(bY.$0)):bY!=null&&bY.$==3?(bY.$0.push(bW),w.EnqueueSafe(bY.$1,bX)):bW(bY.$0);};w.EnqueueSafe=function(bV,bW){var bX,bY,bZ,b0;bV.push(bW);if(bV.length%20===0){bX=bV.slice(0);bJ.Clear(bV);for(bY=0,bZ=bu.length(bX)-1;bY<=bZ;bY++){b0=bu.get(bX,bY);typeof b0=="object"?function(b1){if(b1.s)bV.push(b1);}(b0):function(b1){bV.push(b1);}(b0);}}else void 0;};w.MarkDone=function(bV,bW,bX){var bY;if(bY=bW.s,bY!=null&&bY.$==0)w.MarkForever(bV,bX);else w.MarkReady(bV,bX);};w.MarkReady=function(bV,bW){var bX,bY,bZ,b0;bX=bV.s;if(bX!=null&&bX.$==3){bV.s={$:2,$0:bW,$1:bX.$1};bY=bX.$0;for(bZ=0,b0=bu.length(bY)-1;bZ<=b0;bZ++)(bu.get(bY,bZ))(bW);}else void 0;};w.MarkForever=function(bV,bW){var bX,bY,bZ,b0;bX=bV.s;if(bX!=null&&bX.$==3){bV.s={$:0,$0:bW};bY=bX.$0;for(bZ=0,b0=bu.length(bY)-1;bZ<=b0;bZ++)(bu.get(bY,bZ))(bW);}else void 0;};x=c.Var=bC.Class({},k,x);x.New=bC.Ctor(function(){},x);y=c.View=bC.Class({get_V:function(){return bI.FailWith("View<'T>.V can only be called in an argument to a V-enabled function or if 'T = Doc.");}},null,y);z=c.ConcreteVar=bC.Class({get_Id:function(){return"uinref"+a.String(this.id);},get_View:function(){return this.view;},UpdateMaybe:function(bV){var bW;bW=bV(this.Get());bW!=null&&bW.$==1?this.Set(bW.$0):void 0;},Update:function(bV){this.Set(bV(this.Get()));},SetFinal:function(bV){if(this.isConst)(function(bW){return bW("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(bW){bE.log(bW);}));else{w.Obsolete(this.snap);this.isConst=true;this.current=bV;this.snap=w.New({$:0,$0:bV});}},Set:function(bV){if(this.isConst)(function(bW){return bW("WebSharper.UI: invalid attempt to change value of a Var after calling SetFinal");}(function(bW){bE.log(bW);}));else{w.Obsolete(this.snap);this.current=bV;this.snap=w.New({$:2,$0:bV,$1:[]});}},Get:function(){return this.current;}},x,z);z.New=bC.Ctor(function(bV,bW,bX){var bY;bY=this;x.New.call(this);this.isConst=bV;this.current=bX;this.snap=bW;this.view=function(){return bY.snap;};this.id=h.Int();},z);x.MapLens=function(bV,bW,bX){return y.MapSeqCachedViewBy(bV,function(bY,bZ){var b0,b1;function b2(b3){return bD.Equals(bV(b3),bY);}b0=h.Id();return bW((b1=new x({Get:function(){return bA.find(b2,bX.Get());},Set:function(b3){function b4(b5){return b3;}return bX.Update(function(b5){return f.replaceFirst(b2,b4,b5);});},SetFinal:function(b3){return this.Set(b3);},Update:function(b3){return bX.Update(function(b4){return f.replaceFirst(b2,b3,b4);});},UpdateMaybe:function(b3){return bX.Update(function(b4){return f.maybeReplaceFirst(b2,b3,b4);});},get_View:function(){return bZ;},get_Id:function(){return b0;}}),(x.New.call(b1),b1)));},bX.get_View());};x.Lens=function(bV,bW,bX){var bY,bZ,b0;bY=h.Id();bZ=y.Map(bW,bV.get_View());b0=new x({Get:function(){return bW(bV.Get());},Set:function(b1){return bV.Update(function(b2){return bX(b2,b1);});},SetFinal:function(b1){return this.Set(b1);},Update:function(b1){return bV.Update(function(b2){return bX(b2,b1(bW(b2)));});},UpdateMaybe:function(b1){return bV.UpdateMaybe(function(b2){var b3;b3=b1(bW(b2));return b3==null?null:{$:1,$0:bX(b2,b3.$0)};});},get_View:function(){return bZ;},get_Id:function(){return bY;}});x.New.call(b0);return b0;};x.Update=function(bV,bW){x.Set(bV,bW(bV.Get()));};x.SetFinal=function(bV,bW){bV.SetFinal(bW);};x.Set=function(bV,bW){bV.Set(bW);};x.CreateWaiting=function(){return new z.New(false,w.New({$:3,$0:[],$1:[]}),null);};x.Create=function(){return new z.New(false,w.New({$:2,$0:null,$1:[]}),null);};x.CreateLogged=function(bV,bW){var bX;!window.UINVars?window.UINVars=[]:void 0;bX=x.Create$1(bW);window.UINVars.push([bV,bX]);return bX;};x.Create$1=function(bV){return new z.New(false,w.New({$:2,$0:bV,$1:[]}),bV);};A=c.Updates=bC.Class({set_Value:function(bV){var bW;bW=this.s;!(bW===null)?w.Obsolete(bW):void 0;this.c=bV;}},null,A);A.Create=function(bV){var bW;bW=null;bW=A.New(bV,null,function(){var bX;bX=bW.s;return bX===null?(bX=w.Copy(bW.c()),bW.s=bX,w.WhenObsoleteRun(bX,function(){bW.s=null;}),bX):bX;});return bW;};A.New=function(bV,bW,bX){return new A({c:bV,s:bW,v:bX});};y.get_Do=function(){return B.B;};y.Apply=function(bV,bW){return y.Map2(function(bX,bY){return bX(bY);},bV,bW);};y.AsyncAwait=function(bV,bW){function bX(bY){var bZ,b0;function b1(){return y.RemovableSink(function(b2){if(bV(b2)){(bK.Force(bZ))();bY(b2);}},bW);}bZ=bK.Create(b1);b0=bK.Force(bZ);}return bF.FromContinuations(function(bY,bZ,b0){return bX.apply(null,[bY,bZ,b0]);});};y.RemovableSink=function(bV,bW){var bX;function bY(){w.WhenRun(bW(),function(bZ){if(bX[0])bV(bZ);},function(){if(bX[0])bF.scheduler().Fork(bY);});}bX=[true];bF.scheduler().Fork(bY);return function(){bX[0]=false;};};y.Sink=function(bV,bW){function bX(){w.WhenRun(bW(),bV,function(){bF.scheduler().Fork(bX);});}bF.scheduler().Fork(bX);};y.TryFinally=function(bV,bW){return y.CreateLazy(function(){try{return bW();}finally{bV();}});};y.TryWith=function(bV,bW){return y.CreateLazy(function(){try{return bW();}catch(bX){return(bV(bX))();}});};y.ConstAsync=function(bV){var bW;bW=w.CreateForeverAsync(bV);return function(){return bW;};};y.Const=function(bV){var bW;bW=w.New({$:0,$0:bV});return function(){return bW;};};y.Sequence=function(bV){return y.CreateLazy(function(){return w.Sequence(bA.map(function(bW){return bW();},bV));});};y.UpdateWhile=function(bV,bW,bX){var bY;bY=[bV];return y.BindInner(function(bZ){return bZ?y.Map(function(b0){bY[0]=b0;return b0;},bX):y.Const(bY[0]);},bW);};y.BindInner=function(bV,bW){return y.JoinInner(y.Map(bV,bW));};y.JoinInner=function(bV){return y.CreateLazy(function(){return w.JoinInner(bV());});};y.Bind=function(bV,bW){return y.Join(y.Map(bV,bW));};y.Join=function(bV){return y.CreateLazy(function(){return w.Join(bV());});};y.MapSeqCachedView=function(bV,bW){function bX(bY){return bV;}return y.MapSeqCachedViewBy(a.id,function(bY,bZ){return(bX(bY))(bZ);},bW);};y.MapSeqCachedViewBy=function(bV,bW,bX){var bY;bY=[new bL.New$5()];return y.Map(function(bZ){var b0,b1,b2;b0=bY[0];b1=new bL.New$5();b2=d.mapInPlace(function(b3){var b4,b5,b6;b4=bV(b3);b5=b0.ContainsKey(b4)?(b6=b0.get_Item(b4),(x.Set(b6.r,b3),b6)):y.ConvertSeqNode(function(b7){return bW(b4,b7);},b3);b1.set_Item(b4,b5);return b5.e;},bu.ofSeq(bZ));bY[0]=b1;return b2;},bX);};y.ConvertSeqNode=function(bV,bW){var bX,bY;bX=x.Create$1(bW);bY=bX.get_View();return{e:bV(bY),r:bX,w:bY};};y.MapSeqCached=function(bV,bW){return y.MapSeqCachedBy(a.id,bV,bW);};y.MapSeqCachedBy=function(bV,bW,bX){var bY;bY=[new bL.New$5()];return y.Map(function(bZ){var b0,b1,b2;b0=bY[0];b1=new bL.New$5();b2=d.mapInPlace(function(b3){var b4,b5;b4=bV(b3);b5=b0.ContainsKey(b4)?b0.get_Item(b4):bW(b3);b1.set_Item(b4,b5);return b5;},bu.ofSeq(bZ));bY[0]=b1;return b2;},bX);};y.SnapshotOn=function(bV,bW,bX){var bY;bY=w.New({$:2,$0:bV,$1:[]});return y.CreateLazy(function(){return bY.s==null?w.SnapshotOn(bW(),bX()):(w.WhenObsolete(bW(),bY),bY);});};y.GetAsync=function(bV){return bF.FromContinuations(function(bW){return y.Get(bW,bV);});};y.WithInitOption=function(bV){return y.CreateLazy(function(){return w.WithInitOption(bV());});};y.WithInit=function(bV,bW){return y.CreateLazy(function(){return w.WithInit(bV,bW());});};y.Get=function(bV,bW){var bX;function bY(){w.WhenRun(bW(),function(bZ){if(!bX[0]){bX[0]=true;bV(bZ);}},function(){if(!bX[0])bY();});}bX=[false];bY();};y.MapAsync2=function(bV,bW,bX){return y.MapAsync(a.id,y.Map2(bV,bW,bX));};y.MapAsync=function(bV,bW){return y.CreateLazy(function(){return w.MapAsync(bV,bW());});};y.Map3=function(bV,bW,bX,bY){return y.CreateLazy(function(){return w.Map3(bV,bW(),bX(),bY());});};y.Map2Unit=function(bV,bW){return y.CreateLazy(function(){return w.Map2Unit(bV(),bW());});};y.Map2=function(bV,bW,bX){return y.CreateLazy(function(){return w.Map2(bV,bW(),bX());});};y.MapCached=function(bV,bW){return y.MapCachedBy(bD.Equals,bV,bW);};y.MapCachedBy=function(bV,bW,bX){var bY;bY=[null];return y.CreateLazy(function(){return w.MapCachedBy(bV,bY,bW,bX());});};y.Map=function(bV,bW){return y.CreateLazy(function(){return w.Map(bV,bW());});};y.CreateLazy=function(bV){var bW;bW={c:null,o:bV};return function(){var bX,bY;bX=bW.c;return bX===null?(bX=bW.o(),bW.c=bX,(bY=bX.s,bY!=null&&bY.$==0)?bW.o=null:w.WhenObsoleteRun(bX,function(){bW.c=null;}),bX):bX;};};B.B={$:0};C=c.Submitter=bC.Class({Trigger:function(){this["var"].Set(null);}},k,C);C.New=bC.Ctor(function(bV,bW){this.input=bV;this["var"]=x.Create();this.view=y.SnapshotOn(bW,this["var"].get_View(),this.input);},C);C.CreateOption=function(bV){return new C.New(y.Map(function(bW){return{$:1,$0:bW};},bV),null);};D.Fresh=function(){return{$:0,$0:h.Int()};};E=c.Model=bC.Class({},k,E);E.New=bC.Ctor(function(bV,bW){var bX;bX=x.Create$1(bW);E.New$1.call(this,bX,y.Map(bV,bX.get_View()));},E);E.New$1=bC.Ctor(function(bV,bW){this["var"]=bV;this.view=bW;},E);E.Update=function(bV,bW){x.Update(bW["var"],function(bX){bV(bX);return bX;});};E.Create=function(bV,bW){return new E.New(bV,bW);};F.Default=function(){L.$cctor();return L.Default;};H=G.ArrayStorage=bC.Class({SSet:function(bV){return bu.ofSeq(bV);},SSetAt:function(bV,bW,bX){bu.set(bX,bV,bW);return bX;},SRemoveIf:function(bV,bW){return bu.filter(function(bX){return!bV(bX);},bW);},SInit:function(){return this.init;},SPrependMany:function(bV,bW){var bX;bX=d.ofSeqNonCopying(bV);bW.unshift.apply(bW,bX);return bW;},SPrepend:function(bV,bW){bW.unshift(bV);return bW;},SAppendMany:function(bV,bW){var bX;bX=d.ofSeqNonCopying(bV);bW.push.apply(bW,bX);return bW;},SAppend:function(bV,bW){bW.push(bV);return bW;}},k,H);H.New=bC.Ctor(function(bV){this.init=bV;},H);I=G.LocalStorageBackend=bC.Class({clear:function(){this.storage.removeItem(this.id);},set:function(bV){this.storage.setItem(this.id,bM.stringify(bu.map(this.serializer.Encode,bV)));return bV;},SSet:function(bV){return this.set(bu.ofSeq(bV));},SSetAt:function(bV,bW,bX){bu.set(bX,bV,bW);return this.set(bX);},SRemoveIf:function(bV,bW){return this.set(bu.filter(function(bX){return!bV(bX);},bW));},SInit:function(){var bV;bV=this.storage.getItem(this.id);if(bV===null)return[];else try{return bu.map(this.serializer.Decode,bM.parse(bV));}catch(bW){return[];}},SPrependMany:function(bV,bW){var bX;bX=d.ofSeqNonCopying(bV);bW.unshift.apply(bW,bX);return this.set(bW);},SPrepend:function(bV,bW){bW.unshift(bV);return this.set(bW);},SAppendMany:function(bV,bW){var bX;bX=d.ofSeqNonCopying(bV);bW.push.apply(bW,bX);return this.set(bW);},SAppend:function(bV,bW){bW.push(bV);return this.set(bW);}},k,I);I.New=bC.Ctor(function(bV,bW){this.id=bV;this.serializer=bW;this.storage=a.localStorage;},I);G.LocalStorage=function(bV,bW){return new I.New(bV,bW);};G.InMemory=function(bV){return new H.New(bV);};J=c.ListModel=bC.Class({Wrap:function(bV,bW,bX){return J.Wrap(this,bV,bW,bX);},MapLens:function(bV){var bW;bW=this;return y.MapSeqCachedViewBy(bW.key,function(bX,bY){return bV(bX,bW["LensInto'"](a.id,function(bZ,b0){return b0;},bX,bY));},this["var"].get_View());},Lens:function(bV){return this.LensInto(a.id,function(bW,bX){return bX;},bV);},LensInto:function(bV,bW,bX){return this["LensInto'"](bV,bW,bX,y.Map(bV,this.FindByKeyAsView(bX)));},"LensInto'":function(bV,bW,bX,bY){var bZ,b0,b1;bZ=this;b0=h.Id();b1=new x({Get:function(){return bV(bZ.FindByKey(bX));},Set:function(b2){return bZ.UpdateBy(function(b3){return{$:1,$0:bW(b3,b2)};},bX);},SetFinal:function(b2){return this.Set(b2);},Update:function(b2){return bZ.UpdateBy(function(b3){return{$:1,$0:bW(b3,b2(bV(b3)))};},bX);},UpdateMaybe:function(b2){return bZ.UpdateBy(function(b3){var b4;b4=b2(bV(b3));return b4==null?null:{$:1,$0:bW(b3,b4.$0)};},bX);},get_View:function(){return bY;},get_Id:function(){return b0;}});x.New.call(b1);return b1;},get_LengthAsView:function(){return y.Map(bu.length,this["var"].get_View());},get_Length:function(){return bu.length(this["var"].Get());},Clear:function(){this["var"].Set(this.storage.SSet([]));this.ObsoleteAll();},UpdateBy:function(bV,bW){var bX,bY,bZ,b0,b1;bX=this;bY=this["var"].Get();bZ=bu.tryFindIndex(function(b2){return bD.Equals(bX.key(b2),bW);},bY);bZ!=null&&bZ.$==1?(b0=bZ.$0,b1=bV(bu.get(bY,b0)),b1!=null&&b1.$==1?(this["var"].Set(this.storage.SSetAt(b0,b1.$0,bY)),this.ObsoleteKey(bW)):void 0):void 0;},UpdateAll:function(bV){var bW;bW=this;this["var"].Update(function(bX){bu.iteri(function(bY,bZ){var b0;b0=bV(bZ);return b0==null?null:bu.set(bX,bY,b0.$0);},bX);return bW.storage.SSet(bX);});this.ObsoleteAll();},FindByKeyAsView:function(bV){return y.Map(function(bW){return bW.$0;},this.TryFindByKeyAsView(bV));},TryFindByKeyAsView:function(bV){var bW;bW=this;return function(){var bX,bY,bZ;bX=(bY=null,[bW.it.TryGetValue(bV,{get:function(){return bY;},set:function(b0){bY=b0;}}),bY]);return bX[0]?bX[1]:(bZ=w.New({$:2,$0:bW.TryFindByKey(bV),$1:[]}),(bW.it.Add(bV,bZ),bZ));};},TryFindByKey:function(bV){var bW;bW=this;return bu.tryFind(function(bX){return bD.Equals(bW.key(bX),bV);},this["var"].Get());},FindByKey:function(bV){var bW;bW=this;return bu.find(function(bX){return bD.Equals(bW.key(bX),bV);},this["var"].Get());},TryFindAsView:function(bV){return y.Map(function(bW){return bu.tryFind(bV,bW);},this["var"].get_View());},FindAsView:function(bV){return y.Map(function(bW){return bu.find(bV,bW);},this["var"].get_View());},TryFind:function(bV){return bu.tryFind(bV,this["var"].Get());},Find:function(bV){return bu.find(bV,this["var"].Get());},ContainsKeyAsView:function(bV){var bW;function bX(bY){return bD.Equals(bW.key(bY),bV);}bW=this;return y.Map(function(bY){return bu.exists(bX,bY);},this["var"].get_View());},ContainsKey:function(bV){var bW;bW=this;return bu.exists(function(bX){return bD.Equals(bW.key(bX),bV);},this["var"].Get());},Set:function(bV){this["var"].Set(this.storage.SSet(bV));this.ObsoleteAll();},Iter:function(bV){bu.iter(bV,this["var"].Get());},RemoveByKey:function(bV){var bW;bW=this;this["var"].Set(this.storage.SRemoveIf(function(bX){return bD.Equals(bW.key(bX),bV);},this["var"].Get()));this.ObsoleteKey(bV);},RemoveBy:function(bV){var bW,bX,bY,bZ;bW=this["var"].Get();for(bX=0,bY=bW.length-1;bX<=bY;bX++){bZ=bu.get(bW,bX);bV(bZ)?this.ObsoleteKey(this.key(bZ)):void 0;}this["var"].Set(this.storage.SRemoveIf(bV,this["var"].Get()));},Remove:function(bV){var bW,bX,bY,bZ;bW=this;bX=this["var"].Get();K.Contains(bW.key,bV,bX)?(bY=bW.key,bZ=bY(bV),this["var"].Set(this.storage.SRemoveIf(function(b0){return bD.Equals(bY(b0),bZ);},bX)),this.ObsoleteKey(bZ)):void 0;},PrependMany:function(bV){var bW,bX;function bY(bZ,b0){var b1,b2;b1=bW.key(b0);bW.ObsoleteKey(b1);b2=bu.tryFindIndex(function(b3){return bD.Equals(bW.key(b3),b1);},bZ);return b2==null?(bX.push(b0),bZ):bW.storage.SSetAt(b2.$0,b0,bZ);}bW=this;bX=[];this["var"].Set(this.storage.SPrependMany(bX,(((bC.Curried3(bA.fold))(bY))(this["var"].Get()))(bV)));},Prepend:function(bV){var bW,bX,bY,bZ;bW=this;bX=this["var"].Get();bY=this.key(bV);bZ=bu.tryFindIndex(function(b0){return bD.Equals(bW.key(b0),bY);},bX);bZ!=null&&bZ.$==1?this["var"].Set(this.storage.SSetAt(bZ.$0,bV,bX)):this["var"].Set(this.storage.SPrepend(bV,bX));this.ObsoleteKey(bY);},AppendMany:function(bV){var bW,bX;function bY(bZ,b0){var b1,b2;b1=bW.key(b0);bW.ObsoleteKey(b1);b2=bu.tryFindIndex(function(b3){return bD.Equals(bW.key(b3),b1);},bZ);return b2==null?(bX.push(b0),bZ):bW.storage.SSetAt(b2.$0,b0,bZ);}bW=this;bX=[];this["var"].Set(this.storage.SAppendMany(bX,(((bC.Curried3(bA.fold))(bY))(this["var"].Get()))(bV)));},Append:function(bV){var bW,bX,bY,bZ;bW=this;bX=this["var"].Get();bY=this.key(bV);bZ=bu.tryFindIndex(function(b0){return bD.Equals(bW.key(b0),bY);},bX);bZ!=null&&bZ.$==1?this["var"].Set(this.storage.SSetAt(bZ.$0,bV,bX)):this["var"].Set(this.storage.SAppend(bV,bX));this.ObsoleteKey(bY);},ObsoleteAll:function(){bA.iter(function(bV){w.Obsolete(bV.V);},this.it);this.it.Clear();},ObsoleteKey:function(bV){var bW,bX;bW=(bX=null,[this.it.TryGetValue(bV,{get:function(){return bX;},set:function(bY){bX=bY;}}),bX]);bW[0]?(w.Obsolete(bW[1]),this.it.Remove(bV)):void 0;},GetEnumerator0:function(){return bv.Get0(this["var"].Get());},GetEnumerator:function(){return bv.Get(this["var"].Get());}},k,J);J.New=bC.Ctor(function(bV,bW){J.New$3.call(this,bV,x.Create$1(bu.ofSeq(bA.distinctBy(bV,bW.SInit()))),bW);},J);J.New$1=bC.Ctor(function(bV){J.New$2.call(this,bV,[]);},J);J.New$2=bC.Ctor(function(bV,bW){var bX;bX=bu.ofSeq(bW);J.New$3.call(this,bV,x.Create$1(bX),G.InMemory(bX));},J);J.New$3=bC.Ctor(function(bV,bW,bX){this.key=bV;this["var"]=bW;this.storage=bX;this.v=y.Map(function(bY){return bY.slice();},this["var"].get_View());this.it=new bL.New$5();},J);K.Contains=function(bV,bW,bX){var bY;bY=bV(bW);return bu.exists(function(bZ){return bD.Equals(bV(bZ),bY);},bX);};J.Wrap=function(bV,bW,bX,bY){var bZ,b0;bZ=[new bL.New$5()];b0=bu.map(function(b1){var b2;b2=bX(b1);bZ[0].set_Item(bV.key(b1),b2);return b2;},bV["var"].Get());return new J.New$3(function(b1){return bV.key(bW(b1));},x.Lens(bV["var"],function(b1){var b2,b3;b2=new bL.New$5();b3=bu.map(function(b4){var b5,b6;b5=bV.key(b4);b6=bZ[0].ContainsKey(b5)?bY(bZ[0].get_Item(b5),b4):bX(b4);b2.set_Item(b5,b6);return b6;},b1);bZ[0]=b2;return b3;},function(b1,b2){var b3,b4;b3=new bL.New$5();b4=bu.map(function(b5){var b6;b6=bW(b5);b3.set_Item(bV.key(b6),b5);return b6;},b2);bZ[0]=b3;return b4;}),G.InMemory(b0));};J.FromSeq=function(bV){return J.Create(a.id,bV);};J.Create=function(bV,bW){return J.CreateWithStorage(bV,G.InMemory(bu.ofSeq(bW)));};J.CreateWithStorage=function(bV,bW){return new J.New(bV,bW);};L.$cctor=function(){L.$cctor=a.ignore;L.Default={Encode:a.id,Decode:a.id};};M=c.ReactiveExtensions=bC.Class({},k,M);M.New=bC.Ctor(function(){},M);N=c.DoubleInterpolation=bC.Class({Interpolate:function(bV,bW,bX){return bW+bV*(bX-bW);}},null,N);N.DoubleInterpolation=new N({$:0});O.get_Double=function(){return N.DoubleInterpolation;};P=c.Easing=bC.Class({TransformTime:function(bV){return this.transformTime(bV);}},k,P);P.get_CubicInOut=function(){return Q.CubicInOut();};P.Custom=function(bV){return new P.New(bV);};P.New=bC.Ctor(function(bV){this.transformTime=bV;},P);Q.CubicInOut=function(){U.$cctor();return U.CubicInOut;};R.get_Empty=function(){return{$:0,$0:p.Empty()};};R.WhenDone=function(bV,bW){return R.Append({$:0,$0:p.Single({$:0,$0:bV})},bW);};R.Run=function(bV,bW){var bX;function bY(bZ){function b0(b1,b2){var b3;b3=b2-b1;bW.Compute(b3);bV();return b3<=bX?void a.requestAnimationFrame(function(b4){b0(b1,b4);}):bZ();}a.requestAnimationFrame(function(b1){b0(b1,b1);});}bX=bW.Duration;return bX===0?bF.Zero():bF.FromContinuations(function(bZ,b0,b1){return bY.apply(null,[bZ,b0,b1]);});};R.Play=function(bV){var bW;bW=null;return bF.Delay(function(){return bF.Bind(R.Run(a.ignore,S.Actions(bV)),function(){S.Finalize(bV);return bF.Return(null);});});};R.Pack=function(bV){return{$:0,$0:p.Single({$:1,$0:bV})};};R.Map=function(bV,bW){var bX;return S.Def(bW.Duration,(bX=bW.Compute,function(bY){return bV(bX(bY));}));};R.Delayed=function(bV,bW,bX,bY,bZ,b0){return{Compute:function(b1){return b1<=bY?bZ:bV.Interpolate(bW.TransformTime((b1-bY)/bX),bZ,b0);},Duration:bX+bY};};R.Simple=function(bV,bW,bX,bY,bZ){return{Compute:function(b0){return bV.Interpolate(bW.TransformTime(b0/bX),bY,bZ);},Duration:bX};};R.Const=function(bV){return S.Const(bV);};R.Concat=function(bV){return{$:0,$0:p.Concat(bA.map(S.List,bV))};};R.Append=function(bV,bW){return{$:0,$0:p.Append(bV.$0,bW.$0)};};R.set_UseAnimations=function(bV){S.set_UseAnimations(bV);};R.get_UseAnimations=function(){return S.UseAnimations();};S.UseAnimations=function(){U.$cctor();return U.UseAnimations;};S.set_UseAnimations=function(bV){U.$cctor();U.UseAnimations=bV;};S.Actions=function(bV){return S.ConcatActions(bu.choose(function(bW){return bW.$==1?{$:1,$0:bW.$0}:null;},p.ToArray(bV.$0)));};S.ConcatActions=function(bV){var bW,bX,bY,bZ;bW=d.ofSeqNonCopying(bV);bX=bu.length(bW);return bX===0?S.Const():bX===1?bu.get(bW,0):(bY=bA.max(bA.map(function(b0){return b0.Duration;},bW)),(bZ=bu.map(function(b0){return S.Prolong(bY,b0);},bW),S.Def(bY,function(b0){bu.iter(function(b1){b1.Compute(b0);},bZ);})));};S.Prolong=function(bV,bW){var bX,bY,bZ;bX=bW.Compute;bY=bW.Duration;bZ=bK.Create(function(){return bW.Compute(bW.Duration);});return{Compute:function(b0){return b0>=bY?bZ.f():bX(b0);},Duration:bV};};S.Const=function(bV){return S.Def(0,function(){return bV;});};S.Def=function(bV,bW){return{Compute:bW,Duration:bV};};S.Finalize=function(bV){bu.iter(function(bW){if(bW.$==0)bW.$0();},p.ToArray(bV.$0));};S.List=function(bV){return bV.$0;};T=c.Trans=bC.Class({Copy:function(bV,bW,bX,bY){var bZ,b0,b1,b2,b3;function b4(b5,b6){return bZ.TChange(b5,b6);}bZ=this;b0=bV==null?function(b5){return function(b6){return b4(b5,b6);};}:bV.$0;return new T.New$3(function(b5,b6){return(b0(b5))(b6);},(b1=this.get_TEnter(),bW==null?b1:bW.$0),(b2=this.get_TExit(),bX==null?b2:bX.$0),(b3=this.get_TFlags(),bY==null?b3:bY.$0));},get_TFlags:function(){return this.flags;},get_TExit:function(){return this.exit;},get_TEnter:function(){return this.enter;},TChange:function(bV,bW){return this.change(bV,bW);}},k,T);T.New=bC.Ctor(function(bV,bW,bX){T.New$3.call(this,bV,bD.Equals(bW,null)?R.Const:bW,bD.Equals(bX,null)?R.Const:bX,1|(bD.Equals(bW,null)?0:2)|(bD.Equals(bX,null)?0:4));},T);T.New$1=bC.Ctor(function(bV){T.New$3.call(this,bV,R.Const,R.Const,1);},T);T.New$2=bC.Ctor(function(){T.New$3.call(this,function(bV,bW){return R.Const(bW);},R.Const,R.Const,0);},T);T.New$3=bC.Ctor(function(bV,bW,bX,bY){this.change=bV;this.enter=bW;this.exit=bX;this.flags=bY;},T);T.Exit=function(bV,bW){return bW.Copy(null,null,{$:1,$0:bV},{$:1,$0:bW.get_TFlags()|4});};T.Enter=function(bV,bW){return bW.Copy(null,{$:1,$0:bV},null,{$:1,$0:bW.get_TFlags()|2});};T.Change=function(bV,bW){return bW.Copy({$:1,$0:bV},null,null,{$:1,$0:bW.get_TFlags()|1});};T.Create=function(bV){return new T.New$1(bV);};T.Trivial=function(){return new T.New$2();};T.CanAnimateExit=function(bV){var bW,bX;bW=bV.get_TFlags();bX=4;return(bW&bX)===bX;};T.CanAnimateEnter=function(bV){var bW,bX;bW=bV.get_TFlags();bX=2;return(bW&bX)===bX;};T.CanAnimateChange=function(bV){var bW,bX;bW=bV.get_TFlags();bX=1;return(bW&bX)===bX;};T.AnimateExit=function(bV,bW){return(bV.get_TExit())(bW);};T.AnimateEnter=function(bV,bW){return(bV.get_TEnter())(bW);};T.AnimateChange=function(bV,bW,bX){return bV.TChange(bW,bX);};U.$cctor=function(){U.$cctor=a.ignore;U.CubicInOut=P.Custom(function(bV){var bW;bW=bV*bV;return 3*bW-2*(bW*bV);});U.UseAnimations=true;};V=c.AnimatedAttrNode=bC.Class({sync:function(bV){var bW;if(this.dirty){bW=this.logical;bW==null?void 0:(this.push(bV))(bW.$0);this.visible=this.logical;this.dirty=false;}},pushVisible:function(bV,bW){this.visible={$:1,$0:bW};this.dirty=true;(this.push(bV))(bW);},NChanged:function(){return this.updates;},NSync:a.ignore,NGetExitAnim:function(bV){var bW,bX;bW=this;return R.WhenDone(function(){bW.dirty=true;bW.visible=null;},(bX=this.visible,bX!=null&&bX.$==1?R.Pack(R.Map(function(bY){bW.pushVisible(bV,bY);},T.AnimateExit(this.tr,bX.$0))):R.get_Empty()));},NGetEnterAnim:function(bV){var bW,bX,bY,bZ,b0;bW=this;return R.WhenDone(function(){bW.sync(bV);},(bX=this.visible,(bY=this.logical,bX!=null&&bX.$==1&&(bY!=null&&bY.$==1&&(this.dirty&&(bZ=[bY.$0,bX.$0],true)))?R.Pack(R.Map(function(b1){bW.pushVisible(bV,b1);},T.AnimateChange(this.tr,bZ[1],bZ[0]))):bX==null&&(bY!=null&&bY.$==1)?R.Pack(R.Map(function(b1){bW.pushVisible(bV,b1);},T.AnimateEnter(this.tr,bY.$0))):R.get_Empty())));},NGetChangeAnim:function(bV){var bW,bX,bY,bZ;bW=this;return R.WhenDone(function(){bW.sync(bV);},(bX=this.visible,(bY=this.logical,bX!=null&&bX.$==1&&(bY!=null&&bY.$==1&&(this.dirty&&(bZ=[bY.$0,bX.$0],true)))?R.Pack(R.Map(function(b0){bW.pushVisible(bV,b0);},T.AnimateChange(this.tr,bZ[1],bZ[0]))):R.get_Empty())));}},k,V);V.New=bC.Ctor(function(bV,bW,bX){var bY;bY=this;this.tr=bV;this.push=bX;this.logical=null;this.visible=null;this.dirty=true;this.updates=y.Map(function(bZ){bY.logical={$:1,$0:bZ};bY.dirty=true;},bW);},V);W=c.DynamicAttrNode=bC.Class({NChanged:function(){return this.updates;},NSync:function(bV){if(this.dirty){(this.push(bV))(this.value);this.dirty=false;}},NGetExitAnim:function(bV){return R.get_Empty();},NGetEnterAnim:function(bV){return R.get_Empty();},NGetChangeAnim:function(bV){return R.get_Empty();}},k,W);W.New=bC.Ctor(function(bV,bW){var bX;bX=this;this.push=bW;this.value=void 0;this.dirty=false;this.updates=y.Map(function(bY){bX.value=bY;bX.dirty=true;},bV);},W);X=c.AttrProxy=bC.Class({},null,X);X.Handler=function(bV,bW){return X.HandlerImpl(bV,bW);};X.HandlerImpl=function(bV,bW){return _1.Static(function(bX){bX.addEventListener(bV,function(bY){return(bW(bX))(bY);},false);});};X.Concat=function(bV){var bW;bW=d.ofSeqNonCopying(bV);return d.TreeReduce(_1.EmptyAttr(),X.Append,bW);};X.Append=function(bV,bW){return _1.AppendTree(bV,bW);};X.Create=function(bV,bW){return _1.Static(function(bX){r.SetAttr(bX,bV,bW);});};_0.New=function(bV,bW,bX,bY){var bZ;bZ={DynElem:bV,DynFlags:bW,DynNodes:bX};bC.SetOptional(bZ,"OnAfterRender",bY);return bZ;};_1.Static=function(bV){return new X({$:3,$0:bV});};_1.Dynamic=function(bV,bW){return new X({$:1,$0:new W.New(bV,bW)});};_1.Animated=function(bV,bW,bX){var bY,bZ,b0;bY=new V.New(bV,bW,bX);bZ=4;T.CanAnimateEnter(bV)?bZ=bZ|1:void 0;T.CanAnimateExit(bV)?bZ=bZ|2:void 0;b0=new X({$:1,$0:bY});_1.SetFlags(b0,bZ);return b0;};_1.EmptyAttr=function(){_4.$cctor();return _4.EmptyAttr;};_1.AppendTree=function(bV,bW){var bX;return bV===null?bW:bW===null?bV:(bX=new X({$:2,$0:bV,$1:bW}),(_1.SetFlags(bX,_1.Flags(bV)|_1.Flags(bW)),bX));};_1.GetChangeAnim=function(bV){return _1.GetAnim(bV,function(bW,bX){return bW.NGetChangeAnim(bX);});};_1.GetExitAnim=function(bV){return _1.GetAnim(bV,function(bW,bX){return bW.NGetExitAnim(bX);});};_1.GetEnterAnim=function(bV){return _1.GetAnim(bV,function(bW,bX){return bW.NGetEnterAnim(bX);});};_1.GetAnim=function(bV,bW){return R.Concat(bu.map(function(bX){return bW(bX,bV.DynElem);},bV.DynNodes));};_1.Updates=function(bV){return d.MapTreeReduce(function(bW){return bW.NChanged();},y.Const(),y.Map2Unit,bV.DynNodes);};_1.Empty=function(bV){return _0.New(bV,0,[],null);};_1.Insert=function(bV,bW){var bX,bY,bZ;function b0(b1){if(!(b1===null))if(b1!=null&&b1.$==1)bX.push(b1.$0);else if(b1!=null&&b1.$==2){b0(b1.$0);b0(b1.$1);}else if(b1!=null&&b1.$==3)b1.$0(bV);else if(b1!=null&&b1.$==4)bY.push(b1.$0);}bX=[];bY=[];b0(bW);bZ=bX.slice(0);return _0.New(bV,_1.Flags(bW),bZ,bY.length===0?null:{$:1,$0:function(b1){bA.iter(function(b2){b2(b1);},bY);}});};_1.Sync=function(bV,bW){bu.iter(function(bX){bX.NSync(bV);},bW.DynNodes);};_1.SetFlags=function(bV,bW){bV.flags=bW;};_1.Flags=function(bV){return bV!==null&&bV.hasOwnProperty("flags")?bV.flags:0;};_1.HasExitAnim=function(bV){var bW;bW=2;return(bV.DynFlags&bW)===bW;};_1.HasEnterAnim=function(bV){var bW;bW=1;return(bV.DynFlags&bW)===bW;};_1.HasChangeAnim=function(bV){var bW;bW=4;return(bV.DynFlags&bW)===bW;};_2=c.CheckedInput=bC.Class({get_Input:function(){return this.$==1?this.$0:this.$==2?this.$0:this.$1;}},null,_2);_2.Make=function(bV){return new _2({$:0,$0:bV,$1:a.String(bV)});};_3.ValidateForm=function(){return _3.OnAfterRender(function(bV){if(window.H5F)window.H5F.setup(bV);});};_3.Checked=function(bV){function bW(bX,bY){return!bD.Equals(bV.Get(),bX.checked)?bV.Set(bX.checked):null;}return X.Concat([_3.DynamicProp("checked",bV.get_View()),_3.Handler("change",function(bX){return function(bY){return bW(bX,bY);};}),_3.Handler("click",function(bX){return function(bY){return bW(bX,bY);};})]);};_3.FloatValue=function(bV){return _3.CustomVar(bV,function(bW,bX){var bY;bY=bX.get_Input();return bW.value!==bY?void(bW.value=bY):null;},function(bW){var bX,bY;bX=bW.value;return{$:1,$0:e.isBlank(bX)?(bW.checkValidity?bW.checkValidity():true)?new _2({$:2,$0:bX}):new _2({$:1,$0:bX}):(bY=+bX,a.isNaN(bY)?new _2({$:1,$0:bX}):new _2({$:0,$0:bY,$1:bX}))};});};_3.FloatValueUnchecked=function(bV){return _3.CustomValue(bV,a.String,function(bW){var bX;return e.isBlank(bW)?{$:1,$0:0}:(bX=+bW,a.isNaN(bX)?null:{$:1,$0:bX});});};_3.IntValue=function(bV){return _3.CustomVar(bV,function(bW,bX){var bY;bY=bX.get_Input();return bW.value!==bY?void(bW.value=bY):null;},function(bW){var bX,bY,bZ;bX=bW.value;return{$:1,$0:e.isBlank(bX)?(bW.checkValidity?bW.checkValidity():true)?new _2({$:2,$0:bX}):new _2({$:1,$0:bX}):(bY=(bZ=0,[bN.TryParseInt32(bX,{get:function(){return bZ;},set:function(b0){bZ=b0;}}),bZ]),bY[0]?new _2({$:0,$0:bY[1],$1:bX}):new _2({$:1,$0:bX}))};});};_3.IntValueUnchecked=function(bV){return _3.CustomValue(bV,a.String,function(bW){var bX;return e.isBlank(bW)?{$:1,$0:0}:(bX=+bW,bX!==bX>>0?null:{$:1,$0:bX});});};_3.Value=function(bV){function bW(bX){return{$:1,$0:bX};}return _3.CustomValue(bV,a.id,function(bX){return bW(a.id(bX));});};_3.ContentEditableHtml=function(bV){var bW;bW=_3.CustomVar(bV,function(bX,bY){bX.innerHTML=bY;},function(bX){return{$:1,$0:bX.innerHTML};});return X.Append(X.Create("contenteditable","true"),bW);};_3.ContentEditableText=function(bV){var bW;bW=_3.CustomVar(bV,function(bX,bY){bX.textContent=bY;},function(bX){return{$:1,$0:bX.textContent};});return X.Append(X.Create("contenteditable","true"),bW);};_3.CustomValue=function(bV,bW,bX){return _3.CustomVar(bV,function(bY,bZ){bY.value=bW(bZ);},function(bY){return bX(bY.value);});};_3.CustomVar=function(bV,bW,bX){function bY(b0,b1){return bV.UpdateMaybe(function(b2){var b3,b4;b3=bX(b0);return b3!=null&&b3.$==1&&(!bD.Equals(b3.$0,b2)&&(b4=[b3,b3.$0],true))?b4[0]:null;});}function bZ(b0,b1){var b2,b3;b2=bX(b0);return b2!=null&&b2.$==1&&(bD.Equals(b2.$0,b1)&&(b3=b2.$0,true))?null:bW(b0,b1);}return X.Concat([_3.Handler("change",function(b0){return function(b1){return bY(b0,b1);};}),_3.Handler("input",function(b0){return function(b1){return bY(b0,b1);};}),_3.Handler("keypress",function(b0){return function(b1){return bY(b0,b1);};}),_3.DynamicCustom(function(b0){return function(b1){return bZ(b0,b1);};},bV.get_View())]);};_3.DynamicProp=function(bV,bW){return _1.Dynamic(bW,function(bX){return function(bY){bX[bV]=bY;};});};_3.DynamicPred=function(bV,bW,bX){function bY(bZ,b0){return b0[0]?r.SetAttr(bZ,bV,b0[1]):r.RemoveAttr(bZ,bV);}return _1.Dynamic(y.Map2(function(bZ,b0){return[bZ,b0];},bW,bX),function(bZ){return function(b0){return bY(bZ,b0);};});};_3.DynamicClass=function(bV,bW,bX){return _3.DynamicClassPred(bV,y.Map(bX,bW));};_3.Class=function(bV){return _3.ClassPred(bV,true);};_3.ClassPred=function(bV,bW){return _1.Static(function(bX){if(bW)r.AddClass(bX,bV);else r.RemoveClass(bX,bV);});};_3.DynamicClassPred=function(bV,bW){return _1.Dynamic(bW,function(bX){return function(bY){return bY?r.AddClass(bX,bV):r.RemoveClass(bX,bV);};});};_3.OnAfterRenderView=function(bV,bW){var bX;bX=h.Id();return X.Append(_3.OnAfterRender(function(bY){bW(bY,bY[bX]);}),_3.DynamicCustom(function(bY){return function(bZ){bY[bX]=bZ;};},bV));};_3.OnAfterRender=function(bV){return new X({$:4,$0:bV});};_3.HandlerView=function(bV,bW,bX){return _1.Static(function(bY){var bZ;bZ=bX(bY);bY.addEventListener(bV,function(b0){return y.Get(bZ(b0),bW);},false);});};_3.Handler=function(bV,bW){return _1.Static(function(bX){bX.addEventListener(bV,function(bY){return(bW(bX))(bY);},false);});};_3.DynamicStyle=function(bV,bW){return _1.Dynamic(bW,function(bX){return function(bY){return r.SetStyle(bX,bV,bY);};});};_3.DynamicCustom=function(bV,bW){return _1.Dynamic(bW,bV);};_3.Dynamic=function(bV,bW){return _1.Dynamic(bW,function(bX){return function(bY){return r.SetAttr(bX,bV,bY);};});};_3.AnimatedStyle=function(bV,bW,bX,bY){return _1.Animated(bW,bX,function(bZ){return function(b0){return r.SetStyle(bZ,bV,bY(b0));};});};_3.Animated=function(bV,bW,bX,bY){return _1.Animated(bW,bX,function(bZ){return function(b0){return r.SetAttr(bZ,bV,bY(b0));};});};_3.Style=function(bV,bW){return _1.Static(function(bX){r.SetStyle(bX,bV,bW);});};_4.$cctor=function(){_4.$cctor=a.ignore;_4.EmptyAttr=null;};_5.BatchUpdatesEnabled=function(){bd.$cctor();return bd.BatchUpdatesEnabled;};_5.set_BatchUpdatesEnabled=function(bV){bd.$cctor();bd.BatchUpdatesEnabled=bV;};_6=c.DocElemNode=bC.Class({GetHashCode:function(){return this.ElKey;},Equals:function(bV){return this.ElKey===bV.ElKey;}},null,_6);_6.New=function(bV,bW,bX,bY,bZ,b0){var b1;return new _6((b1={Attr:bV,Children:bW,El:bY,ElKey:bZ},(bC.SetOptional(b1,"Delimiters",bX),bC.SetOptional(b1,"Render",b0),b1)));};_8.FoldBack=function(bV,bW,bX){return bu.foldBack(bV,bW.$0,bX);};_8.Iter=function(bV,bW){bu.iter(bV,bW.$0);};_8.Except=function(bV,bW){var bX;bX=bV.$0;return{$:0,$0:bu.filter(function(bY){return bu.forall(function(bZ){return!(bY===bZ);},bX);},bW.$0)};};_8.DocChildren=function(bV){var bW;function bX(bY){if(bY!=null&&bY.$==2)bX(bY.$0.Current);else if(bY!=null&&bY.$==1)bW.push(bY.$0.El);else if(bY==null);else if(bY!=null&&bY.$==5)bW.push(bY.$0);else if(bY!=null&&bY.$==4)bW.push(bY.$0.Text);else if(bY!=null&&bY.$==6)bu.iter(function(bZ){if(bZ.constructor===a.Object)bX(bZ);else bW.push(bZ);},bY.$0.Els);else{bX(bY.$0);bX(bY.$1);}}bW=[];bX(bV.Children);return{$:0,$0:d.ofSeqNonCopying(bW)};};_8.Children=function(bV,bW){var bX,bY,bZ;if(bW!=null&&bW.$==1){bZ=[];bX=bW.$0[0].nextSibling;while(bX!==bW.$0[1]){bZ.push(bX);bX=bX.nextSibling;}return{$:0,$0:bZ};}else return{$:0,$0:bu.init(bV.childNodes.length,(bY=bV.childNodes,function(b0){return bY[b0];}))};};_9.ToArray=function(bV){return i.ToArray(bV.$0);};_9.get_Empty=function(){return{$:0,$0:new bz.New$3()};};_9.IsEmpty=function(bV){return bV.$0.get_Count()===0;};_9.Intersect=function(bV,bW){return{$:0,$0:i.Intersect(bV.$0,bW.$0)};};_9.Except=function(bV,bW){return{$:0,$0:i.Except(bV.$0,bW.$0)};};_9.FindAll=function(bV){var bW;function bX(bZ){if(bZ!=null&&bZ.$==0){bX(bZ.$0);bX(bZ.$1);}else if(bZ!=null&&bZ.$==1)bY(bZ.$0);else if(bZ!=null&&bZ.$==2)bX(bZ.$0.Current);else if(bZ!=null&&bZ.$==6)bu.iter(bY,bZ.$0.Holes);}function bY(bZ){bW.push(bZ);bX(bZ.Children);}bW=[];bX(bV);return{$:0,$0:new bz.New$2(bW)};};_9.Filter=function(bV,bW){return{$:0,$0:i.Filter(bV,bW.$0)};};_.New=function(bV,bW){return{PreviousNodes:bV,Top:bW};};$.TextHoleRE=function(){bd.$cctor();return bd.TextHoleRE;};$.LocalTemplatesLoaded=function(){bd.$cctor();return bd.LocalTemplatesLoaded;};$.set_LocalTemplatesLoaded=function(bV){bd.$cctor();bd.LocalTemplatesLoaded=bV;};$.LoadedTemplateFile=function(bV){var bW,bX,bY;bW=(bX=null,[$.LoadedTemplates().TryGetValue(bV,{get:function(){return bX;},set:function(bZ){bX=bZ;}}),bX]);return bW[0]?bW[1]:(bY=new bL.New$5(),($.LoadedTemplates().set_Item(bV,bY),bY));};$.LoadedTemplates=function(){bd.$cctor();return bd.LoadedTemplates;};$.UpdateTextNode=function(bV,bW){bV.Value=bW;bV.Dirty=true;};$.CreateTextNode=function(){return{Text:r.CreateText(""),Dirty:false,Value:""};};$.UpdateEmbedNode=function(bV,bW){bV.Current=bW;bV.Dirty=true;};$.CreateEmbedNode=function(){return{Current:null,Dirty:false};};$.PerformSyncUpdate=function(bV,bW){var bX;bX=_9.FindAll(bW);$.SyncElemNode(bV.Top);bV.PreviousNodes=bX;};$.PerformAnimatedUpdate=function(bV,bW){var bX;return R.get_UseAnimations()?(bX=null,bF.Delay(function(){var bY,bZ,b0;bY=_9.FindAll(bW);bZ=$.ComputeChangeAnim(bV,bY);b0=$.ComputeEnterAnim(bV,bY);return bF.Bind(R.Play(R.Append(bZ,$.ComputeExitAnim(bV,bY))),function(){return bF.Bind($.SyncElemNodesNextFrame(bV),function(){return bF.Bind(R.Play(b0),function(){bV.PreviousNodes=bY;return bF.Return(null);});});});})):$.SyncElemNodesNextFrame(bV);};$.SyncElemNodesNextFrame=function(bV){function bW(bX){a.requestAnimationFrame(function(){$.SyncElemNode(bV.Top);bX();});}return _5.BatchUpdatesEnabled()?bF.FromContinuations(function(bX,bY,bZ){return bW.apply(null,[bX,bY,bZ]);}):($.SyncElemNode(bV.Top),bF.Return(null));};$.ComputeEnterAnim=function(bV,bW){return R.Concat(bu.map(function(bX){return _1.GetEnterAnim(bX.Attr);},_9.ToArray(_9.Except(bV.PreviousNodes,_9.Filter(function(bX){return _1.HasEnterAnim(bX.Attr);},bW)))));};$.ComputeChangeAnim=function(bV,bW){var bX;function bY(bZ){return _1.HasChangeAnim(bZ.Attr);}bX=function(bZ){return _9.Filter(bY,bZ);};return R.Concat(bu.map(function(bZ){return _1.GetChangeAnim(bZ.Attr);},_9.ToArray(_9.Intersect(bX(bV.PreviousNodes),bX(bW)))));};$.ComputeExitAnim=function(bV,bW){return R.Concat(bu.map(function(bX){return _1.GetExitAnim(bX.Attr);},_9.ToArray(_9.Except(bW,_9.Filter(function(bX){return _1.HasExitAnim(bX.Attr);},bV.PreviousNodes)))));};$.CreateDelimitedRunState=function(bV,bW,bX){return _.New(_9.get_Empty(),$.CreateDelimitedElemNode(bV,bW,_1.EmptyAttr(),bX));};$.CreateRunState=function(bV,bW){return _.New(_9.get_Empty(),$.CreateElemNode(bV,_1.EmptyAttr(),bW));};$.CreateDelimitedElemNode=function(bV,bW,bX,bY){var bZ,b0;bZ=bV.parentNode;$.LinkPrevElement(bW,bY);b0=_1.Insert(bZ,bX);return _6.New(b0,bY,{$:1,$0:[bV,bW]},bZ,h.Int(),bC.GetOptional(b0.OnAfterRender));};$.CreateElemNode=function(bV,bW,bX){var bY;$.LinkElement(bV,bX);bY=_1.Insert(bV,bW);return _6.New(bY,bX,null,bV,h.Int(),bC.GetOptional(bY.OnAfterRender));};$.SyncElemNode=function(bV){$.SyncElement(bV);$.Sync(bV.Children);$.AfterRender(bV);};$.Sync=function(bV){var bW,bX;if(bV!=null&&bV.$==1)$.SyncElemNode(bV.$0);else if(bV!=null&&bV.$==2)$.Sync(bV.$0.Current);else if(bV==null);else if(bV!=null&&bV.$==5);else if(bV!=null&&bV.$==4){bW=bV.$0;bW.Dirty?(bW.Text.nodeValue=bW.Value,bW.Dirty=false):void 0;}else if(bV!=null&&bV.$==6){bX=bV.$0;bu.iter(function(bY){$.SyncElemNode(bY);},bX.Holes);bu.iter(function(bY){_1.Sync(bY[0],bY[1]);},bX.Attrs);$.AfterRender(bX);}else{$.Sync(bV.$0);$.Sync(bV.$1);}};$.AfterRender=function(bV){var bW;bW=bC.GetOptional(bV.Render);bW!=null&&bW.$==1?(bW.$0(bV.El),bC.SetOptional(bV,"Render",null)):void 0;};$.InsertBeforeDelim=function(bV,bW){var bX,bY;bX=bV.parentNode;bY=a.document.createTextNode("");bX.insertBefore(bY,bV);$.LinkPrevElement(bV,bW);return bY;};$.LinkPrevElement=function(bV,bW){$.InsertDoc(bV.parentNode,bW,bV);};$.LinkElement=function(bV,bW){$.InsertDoc(bV,bW,null);};$.SyncElement=function(bV){function bW(bX){function bY(bZ){var b0,b1;return bZ!=null&&bZ.$==0?bY(bZ.$0)||bY(bZ.$1):bZ!=null&&bZ.$==2?(b0=bZ.$0,b0.Dirty||bY(b0.Current)):bZ!=null&&bZ.$==6&&(b1=bZ.$0,b1.Dirty||bu.exists(bW,b1.Holes));}return bY(bX.Children);}_1.Sync(bV.El,bV.Attr);bW(bV)?$.DoSyncElement(bV):void 0;};$.DoSyncElement=function(bV){var bW,bX,bY;function bZ(b0,b1){var b2,b3;return b0!=null&&b0.$==1?b0.$0.El:b0!=null&&b0.$==2?(b2=b0.$0,b2.Dirty?(b2.Dirty=false,$.InsertDoc(bW,b2.Current,b1)):bZ(b2.Current,b1)):b0==null?b1:b0!=null&&b0.$==4?b0.$0.Text:b0!=null&&b0.$==5?b0.$0:b0!=null&&b0.$==6?(b3=b0.$0,(b3.Dirty?b3.Dirty=false:void 0,bu.foldBack(function(b4,b5){return b4.constructor===a.Object?bZ(b4,b5):b4;},b3.Els,b1))):bZ(b0.$0,bZ(b0.$1,b1));}bW=bV.El;_8.Iter((bX=bV.El,function(b0){r.RemoveNode(bX,b0);}),_8.Except(_8.DocChildren(bV),_8.Children(bV.El,bC.GetOptional(bV.Delimiters))));bZ(bV.Children,(bY=bC.GetOptional(bV.Delimiters),bY!=null&&bY.$==1?bY.$0[1]:null));};$.InsertDoc=function(bV,bW,bX){var bY;return bW!=null&&bW.$==1?$.InsertNode(bV,bW.$0.El,bX):bW!=null&&bW.$==2?(bY=bW.$0,(bY.Dirty=false,$.InsertDoc(bV,bY.Current,bX))):bW==null?bX:bW!=null&&bW.$==4?$.InsertNode(bV,bW.$0.Text,bX):bW!=null&&bW.$==5?$.InsertNode(bV,bW.$0,bX):bW!=null&&bW.$==6?bu.foldBack(function(bZ,b0){return bZ.constructor===a.Object?$.InsertDoc(bV,bZ,b0):$.InsertNode(bV,bZ,b0);},bW.$0.Els,bX):$.InsertDoc(bV,bW.$0,$.InsertDoc(bV,bW.$1,bX));};$.InsertNode=function(bV,bW,bX){r.InsertAt(bV,bX,bW);return bW;};ba=c.Doc=bC.Class({ReplaceInDom:function(bV){var bW;bW=a.document.createTextNode("");bV.parentNode.replaceChild(bW,bV);ba.RunBefore(bW,this);}},k,ba);ba.Append=function(bV,bW){return ba.Mk({$:0,$0:bV.docNode,$1:bW.docNode},y.Map2Unit(bV.updates,bW.updates));};ba.Concat=function(bV){var bW;bW=d.ofSeqNonCopying(bV);return d.TreeReduce(ba.Empty(),ba.Append,bW);};ba.Empty=function(){return ba.Mk(null,y.Const());};ba.TextNode=function(bV){return ba.Mk({$:5,$0:r.CreateText(bV)},y.Const());};ba.Verbatim=function(bV){var bW;return ba.Mk(d.MapTreeReduce(function(bX){return bD.Equals(bX.nodeType,bO.TEXT_NODE)?{$:5,$0:bX}:{$:1,$0:$.CreateElemNode(bX,_1.EmptyAttr(),null)};},null,function(bX,bY){return{$:0,$0:bX,$1:bY};},(bW=bP.parseHTML(bV),bD.Equals(bW,null)?[]:bW)),y.Const());};ba.SvgElementMixed=function(bV,bW){var bX;bX=ba.MixedNodes(bW);return ba.SvgElement(bV,bX[0],bX[1]);};ba.SvgElement=function(bV,bW,bX){var bY,bZ;bY=X.Concat(bW);bZ=ba.Concat(bX);return bb.New(r.CreateSvgElement(bV),bY,bZ);};ba.ElementMixed=function(bV,bW){var bX;bX=ba.MixedNodes(bW);return ba.Element(bV,bX[0],bX[1]);};ba.ConcatMixed=function(bV){return ba.Concat(bA.map(ba.ToMixedDoc,bV));};ba.MixedNodes=function(bV){var bW,bX,bY,bZ;bW=[];bX=[];bY=bv.Get(bV);try{while(bY.MoveNext()){bZ=bY.Current();bZ instanceof X?bW.push(bZ):bX.push(ba.ToMixedDoc(bZ));}}finally{if("Dispose"in bY)bY.Dispose();}return[bW,bX];};ba.ToMixedDoc=function(bV){return bV instanceof ba?bV:typeof bV=="string"?ba.TextNode(bV):bV instanceof a.Element?ba.Static(bV):typeof bV=="function"?ba.EmbedView(y.Map(ba.ToMixedDoc,bV)):bV instanceof x?ba.EmbedView(y.Map(ba.ToMixedDoc,bV.get_View())):bD.Equals(bV,null)?ba.Empty():ba.TextNode(a.String(bV));};ba.Element=function(bV,bW,bX){var bY,bZ;bY=X.Concat(bW);bZ=ba.Concat(bX);return bb.New(r.CreateElement(bV),bY,bZ);};ba.Radio=function(bV,bW,bX){var bY,bZ;bY=r.CreateElement("input");bY.addEventListener("click",function(){return bX.Set(bW);},false);bZ=_3.DynamicProp("checked",y.Map(function(b0){return bD.Equals(b0,bW);},bX.get_View()));return bb.New(bY,X.Concat(bt.append(bt.ofArray([X.Create("type","radio"),X.Create("name",bX.get_Id()),bZ]),bt.ofSeq(bV))),ba.Empty());};ba.LinkView=function(bV,bW,bX,bY){var bZ;bZ=X.Concat(bA.append([_3.HandlerView("click",bX,function(){return function(){return bY;};}),X.Create("href","#")],bW));return bb.New(r.CreateElement("a"),bZ,ba.TextNode(bV));};ba.Link=function(bV,bW,bX){var bY,bZ;bY=(bZ=X.Concat(bW),X.Append(X.Create("href","#"),bZ));return bb.New(ba.Clickable("a",bX),bY,ba.TextNode(bV));};ba.ButtonView=function(bV,bW,bX,bY){var bZ;bZ=X.Concat(bA.append([_3.HandlerView("click",bX,function(){return function(){return bY;};})],bW));return bb.New(r.CreateElement("button"),bZ,ba.TextNode(bV));};ba.Button=function(bV,bW,bX){var bY;bY=X.Concat(bW);return bb.New(ba.Clickable("button",bX),bY,ba.TextNode(bV));};ba.Clickable=function(bV,bW){var bX;bX=r.CreateElement(bV);bX.addEventListener("click",function(bY){bY.preventDefault();return bW();},false);return bX;};ba.CheckBoxGroup=function(bV,bW,bX){function bY(bZ){return bD.Equals(bW,bZ);}return ba.CheckBox(bV,x.Lens(bX,function(bZ){return bt.exists(bY,bZ);},function(bZ,b0){return b0?bt.exists(function(b1){return bD.Equals(bW,b1);},bZ)?bZ:new bt.T({$:1,$0:bW,$1:bZ}):bt.filter(function(b1){return!bD.Equals(bW,b1);},bZ);}));};ba.CheckBox=function(bV,bW){return ba.InputInternal("input",function(){return bA.append(bV,[X.Create("type","checkbox"),_3.Checked(bW)]);});};ba.SelectDynOptional=function(bV,bW,bX,bY,bZ){return ba.SelectDyn(bV,function(b0){return b0!=null&&b0.$==1?bX(b0.$0):bW;},y.Map(function(b0){return new bt.T({$:1,$0:null,$1:bt.map(function(b1){return{$:1,$0:b1};},b0)});},bY),bZ);};ba.SelectOptional=function(bV,bW,bX,bY,bZ){return ba.Select(bV,function(b0){return b0!=null&&b0.$==1?bX(b0.$0):bW;},new bt.T({$:1,$0:null,$1:bt.map(function(b0){return{$:1,$0:b0};},bY)}),bZ);};ba.Select=function(bV,bW,bX,bY){return ba.SelectImpl(bV,bW,function(bZ){bZ[0]=bX;return ba.Concat(bt.mapi(function(b0,b1){return ba.Element("option",bt.ofArray([X.Create("value",a.String(b0))]),bt.ofArray([ba.TextNode(bW(b1))]));},bX));},bY);};ba.SelectDyn=function(bV,bW,bX,bY){return ba.SelectImpl(bV,bW,function(bZ){function b0(b1,b2){return ba.Element("option",bt.ofArray([X.Create("value",a.String(b1))]),bt.ofArray([ba.TextNode(bW(b2))]));}return ba.Convert(function(b1){return b0(b1[0],b1[1]);},y.Map(function(b1){bZ[0]=b1;return bA.mapi(function(b2,b3){return[b2,b3];},b1);},bX));},bY);};ba.SelectImpl=function(bV,bW,bX,bY){var bZ,b0,b1,b2;function b3(b8){return b8.selectedIndex;}function b4(b8,b9){b8.selectedIndex=b9;}function b5(b8){var b9;b9=b3(b8);return bZ[0].get_Item(b9);}function b6(b8){return bA.findIndex(function(b9){return bD.Equals(b8,b9);},bZ[0]);}function b7(b8,b9){return b4(b8,b6(b9));}bZ=[bt.T.Empty];b0=r.CreateElement("select");b1=_3.DynamicCustom(function(b8){return function(b9){return b7(b8,b9);};},bY.get_View());b0.addEventListener("change",function(){bY.UpdateMaybe(function(b8){var b9;b9=b5(b0);return bD.Equals(b8,b9)?null:{$:1,$0:b9};});},false);return bb.New(b0,(b2=X.Append(b1,X.Concat(bV)),X.Append(_3.OnAfterRender(function(b8){b7(b8,bY.Get());}),b2)),bX(bZ));};ba.InputArea=function(bV,bW){return ba.InputInternal("textarea",function(){return bA.append(bV,[_3.Value(bW)]);});};ba.FloatInput=function(bV,bW){return ba.InputInternal("input",function(){return bA.append(bV,[_3.FloatValue(bW),X.Create("type","number")]);});};ba.FloatInputUnchecked=function(bV,bW){return ba.InputInternal("input",function(){return bA.append(bV,[bW.Get()===0?X.Create("value","0"):_1.EmptyAttr(),_3.FloatValueUnchecked(bW),X.Create("type","number")]);});};ba.IntInput=function(bV,bW){return ba.InputInternal("input",function(){return bA.append(bV,[_3.IntValue(bW),X.Create("type","number")]);});};ba.IntInputUnchecked=function(bV,bW){return ba.InputInternal("input",function(){return bA.append(bV,[bW.Get()===0?X.Create("value","0"):_1.EmptyAttr(),_3.IntValueUnchecked(bW),X.Create("type","number")]);});};ba.PasswordBox=function(bV,bW){return ba.InputInternal("input",function(){return bA.append(bV,[_3.Value(bW),X.Create("type","password")]);});};ba.Input=function(bV,bW){return ba.InputInternal("input",function(){return bA.append(bV,[_3.Value(bW)]);});};ba.InputInternal=function(bV,bW){var bX;bX=r.CreateElement(bV);return bb.New(bX,X.Concat(bW(bX)),ba.Empty());};ba.ConvertSeqVarBy=function(bV,bW,bX){return ba.Flatten(x.MapLens(bV,bW,bX));};ba.ConvertSeqBy=function(bV,bW,bX){return ba.Flatten(y.MapSeqCachedViewBy(bV,function(bY,bZ){return(bW(bY))(bZ);},bX));};ba.ConvertSeq=function(bV,bW){return ba.Flatten(y.MapSeqCachedView(bV,bW));};ba.ConvertBy=function(bV,bW,bX){return ba.Flatten(y.MapSeqCachedBy(bV,bW,bX));};ba.Convert=function(bV,bW){return ba.Flatten(y.MapSeqCached(bV,bW));};ba.Flatten=function(bV){return ba.EmbedView(y.Map(ba.Concat,bV));};ba.GetOrLoadTemplate=function(bV,bW,bX,bY){ba.LoadLocalTemplates$1();ba.PrepareTemplate(bV,bW,bX);return ba.NamedTemplate(bV,bW,bY);};ba.NamedTemplate=function(bV,bW,bX){var bY,bZ;bY=(bZ=null,[$.LoadedTemplateFile(bV).TryGetValue(bW==null?"":bW.$0,{get:function(){return bZ;},set:function(b0){bZ=b0;}}),bZ]);return bY[0]?ba.ChildrenTemplate(bY[1].cloneNode(true),bX):(bE.warn("Local template doesn't exist",bW),ba.Empty());};ba.LoadLocalTemplates=function(bV){var bW;bW=$.LoadedTemplateFile("");bW.count>0?$.LoadedTemplates().set_Item(bV,bW):(function(){var bX,bY,bZ,b0;while(true){bX=a.document.querySelector("[ws-template]");if(bD.Equals(bX,null)){bY=a.document.querySelector("[ws-children-template]");if(bD.Equals(bY,null))return null;else{bZ=bY.getAttribute("ws-children-template");bY.removeAttribute("ws-children-template");ba.PrepareTemplate(bV,{$:1,$0:bZ},function(b1){return function(){return r.ChildrenArray(b1);};}(bY));}}else{b0=bX.getAttribute("ws-template");ba.PrepareSingleTemplate(bV,{$:1,$0:b0},bX);}}}(),$.LoadedTemplates().set_Item("",$.LoadedTemplateFile(bV)));};ba.LoadLocalTemplates$1=function(){if(!$.LocalTemplatesLoaded()){$.set_LocalTemplatesLoaded(true);ba.LoadLocalTemplates("");}};ba.PrepareTemplate=function(bV,bW,bX){var bY,bZ,b0,b1,b2;if(!$.LoadedTemplateFile(bV).ContainsKey(bW==null?"":bW.$0)){bY=bX();for(bZ=0,b0=bY.length-1;bZ<=b0;bZ++){b1=bu.get(bY,bZ);b2=b1.parentNode;bD.Equals(b2,null)?void 0:b2.removeChild(b1);}ba.PrepareTemplateStrict(bV,bW,bY,null);}};ba.PrepareTemplateStrict=function(bV,bW,bX,bY){var bZ,b0;function b1(cb){var cd,ce,cf,cg,ch,ci,cj,ck;function cc(cl){var cm;cm=cb.getAttribute(cl);cm===null?void 0:cb.setAttribute(cl,cm.toLowerCase());}cd=cb.attributes;ce=[];cf=[];cg=[];for(ch=0,ci=cd.length-1;ch<=ci;ch++){cj=cd.item(ch);bw.StartsWith(cj.nodeName,"ws-on")&&cj.nodeName!=="ws-onafterrender"&&cj.nodeName!=="ws-on"?(ce.push(cj.nodeName),cf.push(bQ.string(cj.nodeName,{$:1,$0:"ws-on".length},null)+":"+cj.nodeValue.toLowerCase())):!bw.StartsWith(cj.nodeName,"ws-")&&(new a.RegExp($.TextHoleRE())).test(cj.nodeValue)?(cj.nodeValue=(ck=new a.RegExp($.TextHoleRE(),"g"),cj.nodeValue.replace(ck,function(cl,cm){return"${"+cm.toLowerCase()+"}";})),cg.push(cj.nodeName)):void 0;}!(cf.length==0)?cb.setAttribute("ws-on",bw.concat(" ",cf)):void 0;!(cg.length==0)?cb.setAttribute("ws-attr-holes",bw.concat(" ",cg)):void 0;cc("ws-hole");cc("ws-replace");cc("ws-attr");cc("ws-onafterrender");cc("ws-var");bu.iter(function(cl){cb.removeAttribute(cl);},ce);}function b2(cb){var cc,cd,ce,cf,cg,ch;cc=null;cd=0;cf=cb.textContent;cg=new a.RegExp($.TextHoleRE(),"g");while(cc=cg.exec(cf),cc!==null){cb.parentNode.insertBefore(a.document.createTextNode(bQ.string(cf,{$:1,$0:cd},{$:1,$0:cg.lastIndex-bu.get(cc,0).length-1})),cb);cd=cg.lastIndex;ch=a.document.createElement("span");ch.setAttribute("ws-replace",bu.get(cc,1).toLowerCase());cb.parentNode.insertBefore(ch,cb);}cg.lastIndex=0;cb.textContent=bQ.string(cf,{$:1,$0:cd},null);}function b3(cb,cc){function cd(ce){r.IterSelector(cb,"["+ce+"]",function(cf){var cg,ch;cg=(ch=null,[cc.TryGetValue(cf.getAttribute(ce).toLowerCase(),{get:function(){return ch;},set:function(ci){ch=ci;}}),ch]);cg[0]?cf.setAttribute(ce,cg[1]):void 0;});}cd("ws-hole");cd("ws-replace");cd("ws-attr");cd("ws-onafterrender");cd("ws-var");r.IterSelector(cb,"[ws-on]",function(ce){ce.setAttribute("ws-on",bw.concat(" ",bu.map(function(cf){var cg,ch,ci;cg=bw.SplitChars(cf,[":"],1);ch=(ci=null,[cc.TryGetValue(bu.get(cg,1),{get:function(){return ci;},set:function(cj){ci=cj;}}),ci]);return ch[0]?bu.get(cg,0)+":"+ch[1]:cf;},bw.SplitChars(ce.getAttribute("ws-on"),[" "],1))));});return r.IterSelector(cb,"[ws-attr-holes]",function(ce){var cf,cg,ch;cf=bw.SplitChars(ce.getAttribute("ws-attr-holes"),[" "],1);for(cg=0,ch=cf.length-1;cg<=ch;cg++)(function(){var ci;function cj(ck,cl){var cm;cm=bI.KeyValue(cl);return ck.replace(new a.RegExp("\\${"+cm[0]+"}","ig"),"${"+cm[1]+"}");}ci=bu.get(cf,cg);return ce.setAttribute(ci,(((bC.Curried3(bA.fold))(cj))(ce.getAttribute(ci)))(cc));}());});}function b4(cb,cc){var cd,ce,cf,cg,ch;b1(cc);cd=cc.nodeName.toLowerCase();ce=cb.querySelector("[ws-attr="+cd+"]");if(bD.Equals(ce,null))return bE.warn("Filling non-existent attr hole",cd);else{ce.removeAttribute("ws-attr");for(cf=0,cg=cc.attributes.length-1;cf<=cg;cf++){ch=cc.attributes.item(cf);ch.name==="class"&&ce.hasAttribute("class")?ce.setAttribute("class",ce.getAttribute("class")+" "+ch.nodeValue):ce.setAttribute(ch.name,ch.nodeValue);}return;}}function b5(cb,cc){function cd(ce){r.IterSelector(cb,"["+ce+"]",function(cf){if(!cc.Contains(cf.getAttribute(ce)))cf.removeAttribute(ce);});}cd("ws-attr");cd("ws-onafterrender");cd("ws-var");r.IterSelector(cb,"[ws-hole]",function(ce){if(!cc.Contains(ce.getAttribute("ws-hole"))){ce.removeAttribute("ws-hole");while(ce.hasChildNodes())ce.removeChild(ce.lastChild);}});r.IterSelector(cb,"[ws-replace]",function(ce){if(!cc.Contains(ce.getAttribute("ws-replace")))ce.parentNode.removeChild(ce);});r.IterSelector(cb,"[ws-on]",function(ce){ce.setAttribute("ws-on",bw.concat(" ",bu.filter(function(cf){return cc.Contains(bu.get(bw.SplitChars(cf,[":"],1),1));},bw.SplitChars(ce.getAttribute("ws-on"),[" "],1))));});return r.IterSelector(cb,"[ws-attr-holes]",function(ce){var cf,cg,ch,ci,cj;cf=bw.SplitChars(ce.getAttribute("ws-attr-holes"),[" "],1);for(cg=0,ch=cf.length-1;cg<=ch;cg++){ci=bu.get(cf,cg);ce.setAttribute(ci,(cj=new a.RegExp($.TextHoleRE(),"g"),ce.getAttribute(ci).replace(cj,function(ck,cl){return cc.Contains(cl)?ck:"";})));}});}function b6(cb,cc){var cd;cd=cb.querySelector("[ws-replace]");return bD.Equals(cd,null)?(bE.warn("Filling non-existent text hole",bW),null):(cd.parentNode.replaceChild(new a.Text(cc),cd),{$:1,$0:cd.getAttribute("ws-replace")});}function b7(cb,cc,cd){while(true)if(cb.hasChildNodes())cd=cc.insertBefore(cb.lastChild,cd);else return null;}function b8(cb,cc,cd){var ce,cf,cg,ch,cj,ck,cl,cm,cn,co,cp,cq,cr,cs,ct,cu,cv,cw,cx,cy,cz,cA,cB,cC,cD,cE;function ci(cF){}while(true)switch(cb){case 0:cj=bQ.string(cc.nodeName,{$:1,$0:3},null).toLowerCase();ck=(ce=cj.indexOf("."),ce===-1?[bV,cj]:[bQ.string(cj,null,{$:1,$0:ce-1}),bQ.string(cj,{$:1,$0:ce+1},null)]);cl=ck[1];cm=ck[0];if(!$.LoadedTemplates().ContainsKey(cm))return bE.warn("Instantiating non-loaded template",cl);else{cn=$.LoadedTemplates().get_Item(cm);if(!cn.ContainsKey(cl))return bE.warn("Instantiating non-loaded template",cl);else{co=cn.get_Item(cl);cp=co.cloneNode(true);cq=new bz.New$3();cr=new bL.New$5();cs=cc.attributes;for(ct=0,cu=cs.length-1;ct<=cu;ct++){cv=cs.item(ct).name.toLowerCase();cr.set_Item(cv,(cw=cs.item(ct).nodeValue,cw===""?cv:cw.toLowerCase()));!cq.Add(cv)?bE.warn("Hole mapped twice",cv):void 0;}for(cx=0,cy=cc.childNodes.length-1;cx<=cy;cx++){cz=cc.childNodes[cx];bD.Equals(cz.nodeType,bO.ELEMENT_NODE)?!cq.Add(cz.nodeName.toLowerCase())?bE.warn("Hole filled twice",cl):void 0:void 0;}cA=cc.childNodes.length===1&&bD.Equals(cc.firstChild.nodeType,bO.TEXT_NODE);if(cA){cg=b6(cp,cc.firstChild.textContent);((function(cF){return function(cG){if(cG!=null)cF(cG.$0);};}((ch=function(cF){return function(cG){return cF.Add(cG);};}(cq),function(cF){return ci(ch(cF));})))(cg));}b5(cp,cq);if(!cA){for(cB=0,cC=cc.childNodes.length-1;cB<=cC;cB++){cD=cc.childNodes[cB];bD.Equals(cD.nodeType,bO.ELEMENT_NODE)?cD.hasAttributes()?b4(cp,cD):b9(cp,cD):void 0;}}b3(cp,cr);(((function(cF){function cG(cH,cI){return b7(cF,cH,cI);}return function(cH){return function(cI){return cG(cH,cI);};};}(cp))(cc.parentNode))(cc));cc.parentNode.removeChild(cc);return;}}break;case 1:if(cd!==null){cE=cd.nextSibling;if(bD.Equals(cd.nodeType,bO.TEXT_NODE))b2(cd);else if(bD.Equals(cd.nodeType,bO.ELEMENT_NODE))b$(cd);cd=cE;}else return null;break;}}function b9(cb,cc){var cd,cf,cg;function ce(ch,ci){var cj,ck,cl;if(cf==="title"&&cc.hasChildNodes()){cj=bP.parseHTML(cc.textContent);cc.removeChild(cc.firstChild);for(ck=0,cl=cj.length-1;ck<=cl;ck++)cc.appendChild(bu.get(cj,ck));}else null;b$(cc);return b7(cc,ch,ci);}cf=cc.nodeName.toLowerCase();r.IterSelector(cb,"[ws-attr-holes]",function(ch){var ci,cj,ck,cl,cm;ci=bw.SplitChars(ch.getAttribute("ws-attr-holes"),[" "],1);for(cj=0,ck=ci.length-1;cj<=ck;cj++){cl=bu.get(ci,cj);ch.setAttribute(cl,(cm=new a.RegExp("\\${"+cf+"}","ig"),ch.getAttribute(cl).replace(cm,cc.textContent)));}});cg=cb.querySelector("[ws-hole="+cf+"]");if(bD.Equals(cg,null)){cd=cb.querySelector("[ws-replace="+cf+"]");return bD.Equals(cd,null)?null:(ce(cd.parentNode,cd),void cd.parentNode.removeChild(cd));}else{while(cg.hasChildNodes())cg.removeChild(cg.lastChild);cg.removeAttribute("ws-hole");return ce(cg,null);}}function b_(cb){return b8(0,cb);}function b$(cb){var cc,cd;if(bw.StartsWith(cb.nodeName.toLowerCase(),"ws-")&&!cb.hasAttribute("ws-template"))b_(cb);else{b1(cb);cc=cb.getAttribute("ws-template");if(cc===null){cd=cb.getAttribute("ws-children-template");if(cd===null)ca(cb,cb.firstChild);else{cb.removeAttribute("ws-children-template");ba.PrepareTemplate(bV,{$:1,$0:cd},function(){return r.ChildrenArray(cb);});while(cb.hasChildNodes())cb.removeChild(cb.lastChild);}}else ba.PrepareSingleTemplate(bV,{$:1,$0:cc},cb);}}function ca(cb,cc){return b8(1,cb,cc);}bZ=bY!=null&&bY.$==1?bY.$0:ba.FakeRoot(bX);b0=(bW==null?"":bW.$0).toLowerCase();$.LoadedTemplateFile(bV).set_Item(b0,bZ);bu.length(bX)>0?ca(bZ,bu.get(bX,0)):void 0;};ba.PrepareSingleTemplate=function(bV,bW,bX){var bY,bZ,b0;bX.removeAttribute("ws-template");bY=bX.getAttribute("ws-replace");bY===null?void 0:(bX.removeAttribute("ws-replace"),bZ=bX.parentNode,bD.Equals(bZ,null)?void 0:(b0=a.document.createElement(bX.tagName),b0.setAttribute("ws-replace",bY),bZ.replaceChild(b0,bX)));ba.PrepareTemplateStrict(bV,bW,[bX],null);};ba.FakeRoot=function(bV){var bW,bX,bY;bW=a.document.createElement("div");for(bX=0,bY=bV.length-1;bX<=bY;bX++)bW.appendChild(bu.get(bV,bX));return bW;};ba.RunFullDocTemplate=function(bV){var bW,bX;ba.PrepareTemplateStrict("",null,r.ChildrenArray(a.document.body),{$:1,$0:a.document.body});bW=ba.ChildrenTemplate(a.document.body,bV);bX=a.document.body;(function(bY){ba.RunInPlace(bX,bY);}(bW));return bW;};ba.ChildrenTemplate=function(bV,bW){var bX,bY,bZ,b0,b1;bX=ba.InlineTemplate(bV,bW);bY=bX[1];bZ=bX[0];b0=bZ.Els;return!bD.Equals(b0,null)&&b0.length===1&&(bu.get(b0,0)instanceof bO&&(bD.Equals(bu.get(b0,0).nodeType,bO.ELEMENT_NODE)&&(b1=bu.get(b0,0),true)))?bb.TreeNode(bZ,bY):ba.Mk({$:6,$0:bZ},bY);};ba.InlineTemplate=function(bV,bW){var bX,bY,b1,b2,b3,b4,b5,b6,b7;function bZ(b8,b9){var b_,b$,ca;b_=_1.Insert(b8,b9);b2.push(_1.Updates(b_));b3.push([b8,b_]);b$=bC.GetOptional(b_.OnAfterRender);return b$==null?null:(ca=b$.$0,void b4.push(function(){ca(b8);}));}function b0(b8){var b9,b_;b9=(b_=null,[b5.TryGetValue(b8,{get:function(){return b_;},set:function(b$){b_=b$;}}),b_]);return b9[0]?b9[1].$==0?{$:1,$0:b9[1].$1}:b9[1].$==1?{$:1,$0:ba.TextNode(b9[1].$1)}:b9[1].$==2?{$:1,$0:ba.TextView(b9[1].$1)}:b9[1].$==7?{$:1,$0:ba.TextView(b9[1].$1.get_View())}:b9[1].$==8?{$:1,$0:ba.TextView(y.Map(a.String,b9[1].$1.get_View()))}:b9[1].$==9?{$:1,$0:ba.TextView(y.Map(function(b$){return b$.get_Input();},b9[1].$1.get_View()))}:b9[1].$==10?{$:1,$0:ba.TextView(y.Map(a.String,b9[1].$1.get_View()))}:b9[1].$==11?{$:1,$0:ba.TextView(y.Map(function(b$){return b$.get_Input();},b9[1].$1.get_View()))}:b9[1].$==12?{$:1,$0:ba.TextView(y.Map(a.String,b9[1].$1.get_View()))}:(bE.warn("Content hole filled with attribute data",b8),null):null;}b1=[];b2=[];b3=[];b4=[];b5=new bL.New$5();b6=bv.Get(bW);try{while(b6.MoveNext()){b7=b6.Current();b5.set_Item(b7.$0,b7);}}finally{if("Dispose"in b6)b6.Dispose();}bX=r.ChildrenArray(bV);r.IterSelector(bV,"[ws-hole]",function(b8){var b9,b_,b$;b$=b8.getAttribute("ws-hole");b8.removeAttribute("ws-hole");while(b8.hasChildNodes())b8.removeChild(b8.lastChild);b9=b0(b$);b9!=null&&b9.$==1?(b_=b9.$0,$.LinkElement(b8,b_.docNode),b1.push(_6.New(_1.Empty(b8),b_.docNode,null,b8,h.Int(),null)),b2.push(b_.updates)):void 0;});r.IterSelector(bV,"[ws-replace]",function(b8){var b9,b_,b$,ca,cb,cc;b9=b0(b8.getAttribute("ws-replace"));b9!=null&&b9.$==1?(b_=b9.$0,b$=b8.parentNode,ca=a.document.createTextNode(""),b$.replaceChild(ca,b8),cb=$.InsertBeforeDelim(ca,b_.docNode),cc=bu.tryFindIndex(function(cd){return b8===cd;},bX),cc==null?void 0:bu.set(bX,cc.$0,b_.docNode),b1.push(_6.New(_1.Empty(b$),b_.docNode,{$:1,$0:[cb,ca]},b$,h.Int(),null)),b2.push(b_.updates)):void 0;});r.IterSelector(bV,"[ws-attr]",function(b8){var b9,b_,b$;b9=b8.getAttribute("ws-attr");b8.removeAttribute("ws-attr");b_=(b$=null,[b5.TryGetValue(b9,{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);b_[0]?b_[1].$==3?bZ(b8,b_[1].$1):bE.warn("Attribute hole filled with non-attribute data",b9):void 0;});r.IterSelector(bV,"[ws-on]",function(b8){bZ(b8,X.Concat(bu.choose(function(b9){var b_,b$,ca;b_=bw.SplitChars(b9,[":"],1);b$=(ca=null,[b5.TryGetValue(bu.get(b_,1),{get:function(){return ca;},set:function(cb){ca=cb;}}),ca]);return b$[0]?b$[1].$==4?{$:1,$0:_3.Handler(bu.get(b_,0),b$[1].$1)}:b$[1].$==5?{$:1,$0:X.Handler(bu.get(b_,0),b$[1].$2)}:(bE.warn("Event hole on"+bu.get(b_,0)+" filled with non-event data",bu.get(b_,1)),null):null;},bw.SplitChars(b8.getAttribute("ws-on"),[" "],1))));b8.removeAttribute("ws-on");});r.IterSelector(bV,"[ws-onafterrender]",function(b8){var b9,b_,b$;b9=b8.getAttribute("ws-onafterrender");b_=(b$=null,[b5.TryGetValue(b9,{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);b_[0]?b_[1].$==6?(b8.removeAttribute("ws-onafterrender"),bZ(b8,_3.OnAfterRender(b_[1].$1))):bE.warn("onafterrender hole filled with non-onafterrender data",b9):void 0;});r.IterSelector(bV,"[ws-var]",function(b8){var b9,b_,b$;b9=b8.getAttribute("ws-var");b8.removeAttribute("ws-var");b_=(b$=null,[b5.TryGetValue(b9,{get:function(){return b$;},set:function(ca){b$=ca;}}),b$]);b_[0]?b_[1].$==7?bZ(b8,_3.Value(b_[1].$1)):b_[1].$==8?bZ(b8,_3.Checked(b_[1].$1)):b_[1].$==9?bZ(b8,_3.IntValue(b_[1].$1)):b_[1].$==10?bZ(b8,_3.IntValueUnchecked(b_[1].$1)):b_[1].$==11?bZ(b8,_3.FloatValue(b_[1].$1)):b_[1].$==12?bZ(b8,_3.FloatValueUnchecked(b_[1].$1)):bE.warn("Var hole filled with non-Var data",b9):void 0;});r.IterSelector(bV,"[ws-attr-holes]",function(b8){var b9,b_,b$,ca;b9=new a.RegExp($.TextHoleRE(),"g");b_=bw.SplitChars(b8.getAttribute("ws-attr-holes"),[" "],1);b8.removeAttribute("ws-attr-holes");for(b$=0,ca=b_.length-1;b$<=ca;b$++)(function(){var cb,cc,cd,ce,cf,cg,ch,ci,cj,ck,cl,cm,cn;ck=bu.get(b_,b$);cl=b8.getAttribute(ck);cb=null;cc=0;cm=[];while(cb=b9.exec(cl),cb!==null){cn=bQ.string(cl,{$:1,$0:cc},{$:1,$0:b9.lastIndex-bu.get(cb,0).length-1});cc=b9.lastIndex;cm.push([cn,bu.get(cb,1)]);}ce=bQ.string(cl,{$:1,$0:cc},null);b9.lastIndex=0;cf=bu.foldBack(function(co,cp){return(function(cq){var cr,cs;cr=cq[0];cs=cq[1];return function(ct){var cu,cv,cw,cx,cy;cu=ct[0];cv=ct[1];cw=(cx=(cy=null,[b5.TryGetValue(cs,{get:function(){return cy;},set:function(cz){cy=cz;}}),cy]),cx[0]?cx[1].$==1?{$:0,$0:cx[1].$1}:cx[1].$==2?{$:1,$0:cx[1].$1}:cx[1].$==7?{$:1,$0:cx[1].$1.get_View()}:cx[1].$==8?{$:1,$0:y.Map(a.String,cx[1].$1.get_View())}:cx[1].$==9?{$:1,$0:y.Map(function(cz){return cz.get_Input();},cx[1].$1.get_View())}:cx[1].$==10?{$:1,$0:y.Map(a.String,cx[1].$1.get_View())}:cx[1].$==11?{$:1,$0:y.Map(function(cz){return cz.get_Input();},cx[1].$1.get_View())}:cx[1].$==12?{$:1,$0:y.Map(a.String,cx[1].$1.get_View())}:(bE.warn("Attribute value hole filled with non-text data",cs),{$:0,$0:""}):{$:0,$0:""});return cw.$==1?[cr,new bt.T({$:1,$0:cu===""?cw.$0:y.Map(function(cz){return cz+cu;},cw.$0),$1:cv})]:[cr+cw.$0+cu,cv];};}(co))(cp);},cm,[ce,bt.T.Empty]);return bZ(b8,cf[1].$==1?cf[1].$1.$==1?cf[1].$1.$1.$==1?cf[1].$1.$1.$1.$==0?(cg=cf[0],_3.Dynamic(ck,y.Map3(function(co,cp,cq){return cg+co+cp+cq;},cf[1].$0,cf[1].$1.$0,cf[1].$1.$1.$0))):(ch=cf[0],_3.Dynamic(ck,y.Map(function(co){return ch+bw.concat("",co);},y.Sequence(cf[1])))):(ci=cf[0],_3.Dynamic(ck,y.Map2(function(co,cp){return ci+co+cp;},cf[1].$0,cf[1].$1.$0))):cf[0]===""?_3.Dynamic(ck,cf[1].$0):(cj=cf[0],_3.Dynamic(ck,y.Map(function(co){return cj+co;},cf[1].$0))):X.Create(ck,cf[0]));}());});return[bC.DeleteEmptyFields({Els:bX,Dirty:true,Holes:b1,Attrs:b3,Render:(bY=b4.length==0?null:{$:1,$0:function(b8){bu.iter(function(b9){b9(b8);},b4);}},bY?bY.$0:void 0)},["Render"]),d.TreeReduce(y.Const(),y.Map2Unit,b2)];};ba.Template=function(bV,bW){return ba.ChildrenTemplate(ba.FakeRoot(bV),bW);};ba.TextView=function(bV){var bW;bW=$.CreateTextNode();return ba.Mk({$:4,$0:bW},y.Map(function(bX){$.UpdateTextNode(bW,bX);},bV));};ba.RunReplaceById=function(bV,bW){var bX;bX=r.Doc().getElementById(bV);bD.Equals(bX,null)?bI.FailWith("invalid id: "+bV):bW.ReplaceInDom(bX);};ba.RunById=function(bV,bW){var bX;bX=r.Doc().getElementById(bV);bD.Equals(bX,null)?bI.FailWith("invalid id: "+bV):ba.Run(bX,bW);};ba.Run=function(bV,bW){ba.LoadLocalTemplates$1();$.LinkElement(bV,bW.docNode);ba.RunInPlace(bV,bW);};ba.RunInPlace=function(bV,bW){var bX;bX=bW.docNode;y.Sink(n.StartProcessor($.PerformAnimatedUpdate($.CreateRunState(bV,bX),bX)),bW.updates);};ba.RunPrependById=function(bV,bW){var bX;bX=r.Doc().getElementById(bV);bD.Equals(bX,null)?bI.FailWith("invalid id: "+bV):ba.RunPrepend(bX,bW);};ba.RunPrepend=function(bV,bW){var bX;bX=a.document.createTextNode("");bV.insertBefore(bX,bV.firstChild);ba.RunBefore(bX,bW);};ba.RunAppendById=function(bV,bW){var bX;bX=r.Doc().getElementById(bV);bD.Equals(bX,null)?bI.FailWith("invalid id: "+bV):ba.RunAppend(bX,bW);};ba.RunAppend=function(bV,bW){var bX;bX=a.document.createTextNode("");bV.appendChild(bX);ba.RunBefore(bX,bW);};ba.RunAfterById=function(bV,bW){var bX;bX=r.Doc().getElementById(bV);bD.Equals(bX,null)?bI.FailWith("invalid id: "+bV):ba.RunAfter(bX,bW);};ba.RunAfter=function(bV,bW){var bX;bX=a.document.createTextNode("");bV.parentNode.insertBefore(bX,bV.nextSibling);ba.RunBetween(bV,bX,bW);};ba.RunBeforeById=function(bV,bW){var bX;bX=r.Doc().getElementById(bV);bD.Equals(bX,null)?bI.FailWith("invalid id: "+bV):ba.RunBefore(bX,bW);};ba.RunBefore=function(bV,bW){var bX;bX=a.document.createTextNode("");bV.parentNode.insertBefore(bX,bV);ba.RunBetween(bX,bV,bW);};ba.RunBetween=function(bV,bW,bX){var bY;$.LinkPrevElement(bW,bX.docNode);bY=$.CreateDelimitedRunState(bV,bW,bX.docNode);y.Sink(R.get_UseAnimations()||_5.BatchUpdatesEnabled()?n.StartProcessor($.PerformAnimatedUpdate(bY,bX.docNode)):function(){$.PerformSyncUpdate(bY,bX.docNode);},bX.updates);};ba.Async=function(bV){return ba.EmbedView(y.MapAsync(a.id,y.Const(bV)));};ba.BindView=function(bV,bW){return ba.EmbedView(y.Map(bV,bW));};ba.EmbedView=function(bV){var bW;bW=$.CreateEmbedNode();return ba.Mk({$:2,$0:bW},y.Map(a.ignore,y.Bind(function(bX){$.UpdateEmbedNode(bW,bX.docNode);return bX.updates;},bV)));};ba.Static=function(bV){return bb.New(bV,_1.EmptyAttr(),ba.Empty());};ba.Mk=function(bV,bW){return new ba.New(bV,bW);};ba.New=bC.Ctor(function(bV,bW){this.docNode=bV;this.updates=bW;},ba);bb=c.Elt=bC.Class({AddClass:function(bV){return this.elt.className+=" "+bV;},ClearHoles:function(){var bV;bV=this.docNode$1;bV!=null&&bV.$==6?bV.$0.Holes=[]:void 0;},AddHole:function(bV){var bW;bW=this.docNode$1;bW!=null&&bW.$==6?bW.$0.Holes.push(bV):void 0;},SetStyle:function(bV,bW){this.elt.style[bV]=bW;},HasClass:function(bV){return(new a.RegExp("(\\s|^)"+bV+"(\\s|$)")).test(this.elt.className);},RemoveClass:function(bV){this.elt.className=this.elt.className.replace(new a.RegExp("(?:(\\s|^)"+bV+")+(\\s|$)","g"),"$1");},GetProperty:function(bV){return this.elt[bV];},SetProperty:function(bV,bW){this.elt[bV]=bW;},RemoveAttribute:function(bV){this.elt.removeAttribute(bV);},HasAttribute:function(bV){return this.elt.hasAttribute(bV);},GetAttribute:function(bV){return this.elt.getAttribute(bV);},SetAttribute:function(bV,bW){this.elt.setAttribute(bV,bW);},SetText:function(bV){var bW;bW=this.docNode$1;bW!=null&&bW.$==1?bW.$0.Children=null:bW!=null&&bW.$==6?(bW.$0.Els=[],this.ClearHoles()):bI.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());this.elt.textContent=bV;},GetText:function(){return this.elt.textContent;},SetValue:function(bV){this.elt.value=bV;},GetValue:function(){return this.elt.value;},Id:function(){return this.elt.id;},Html:function(){return this.elt.outerHTML;},Clear:function(){var bV;bV=this.docNode$1;bV!=null&&bV.$==1?bV.$0.Children=null:bV!=null&&bV.$==6?(bV.$0.Els=[],this.ClearHoles()):bI.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Const());while(this.elt.hasChildNodes())this.elt.removeChild(this.elt.firstChild);},Prepend:function(bV){var bW,bX,bY,bZ,b0;bW=this.docNode$1;bW!=null&&bW.$==1?(bX=bW.$0,bX.Children={$:0,$0:bV.docNode,$1:bX.Children},$.InsertDoc(this.elt,bV.docNode,(bY=this.elt.firstChild,bD.Equals(bY,null)?null:bY))):bW!=null&&bW.$==6?(bZ=this.elt.insertBefore(a.document.createTextNode(""),this.elt.firstChild),b0=$.InsertBeforeDelim(bZ,bV.docNode),this.AddHole(_6.New(_1.Empty(this.elt),bV.docNode,{$:1,$0:[b0,bZ]},this.elt,h.Int(),null))):bI.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,bV.updates));},Append:function(bV){var bW,bX,bY,bZ;bW=this.docNode$1;bW!=null&&bW.$==1?(bX=bW.$0,bX.Children={$:0,$0:bX.Children,$1:bV.docNode},$.InsertDoc(this.elt,bV.docNode,null)):bW!=null&&bW.$==6?(bY=this.elt.appendChild(a.document.createTextNode("")),bZ=$.InsertBeforeDelim(bY,bV.docNode),this.AddHole(_6.New(_1.Empty(this.elt),bV.docNode,{$:1,$0:[bZ,bY]},this.elt,h.Int(),null))):bI.FailWith("Invalid docNode in Elt");this.rvUpdates.set_Value(y.Map2Unit(this.rvUpdates.c,bV.updates));},ToUpdater:function(){var bV,bW;return new bc.New((bV=this.docNode$1,bV!=null&&bV.$==1?bC.DeleteEmptyFields({Els:[this.elt],Dirty:true,Holes:[],Attrs:[[this.elt,bV.$0.Attr]],Render:(bW=null,bW?bW.$0:void 0)},["Render"]):bV!=null&&bV.$==6?bV.$0:bI.FailWith("Invalid docNode in Elt")),this.updates$1,this.elt,this.rvUpdates,x.Create$1([]));},OnAfterRenderView:function(bV,bW){var bX,bY;bX=this;bY=h.Id();this.Append(ba.BindView(function(bZ){bX.elt[bY]=bZ;return ba.Empty();},bV));return this.OnAfterRender(function(bZ){bW(bZ,bZ[bY]);});},OnAfterRender:function(bV){var bW,bX,bY,bZ,b0,b1,b2;bW=this.docNode$1;bW!=null&&bW.$==1?(bX=bW.$0,bC.SetOptional(bX,"Render",(bY=bC.GetOptional(bX.Render),bY!=null&&bY.$==1?(bZ=bY.$0,{$:1,$0:function(b3){bZ(b3);bV(b3);}}):{$:1,$0:bV}))):bW!=null&&bW.$==6?(b0=bW.$0,bC.SetOptional(b0,"Render",(b1=bC.GetOptional(b0.Render),b1!=null&&b1.$==1?(b2=b1.$0,{$:1,$0:function(b3){b2(b3);bV(b3);}}):{$:1,$0:bV}))):bI.FailWith("Invalid docNode in Elt");return this;},onView:function(bV,bW,bX){var bY;bY=bX(this.elt);this.elt.addEventListener(bV,function(bZ){return y.Get(bY(bZ),bW);},false);return this;},on:function(bV,bW){this.elt.addEventListener(bV,function(bX){return bW(bX.target,bX);},false);return this;}},ba,bb);bb.TreeNode=function(bV,bW){var bX,bY;function bZ(b0){return b0[1];}bX=A.Create(bW);return new bb.New$1({$:6,$0:bV},y.Map2Unit((bY=bu.map(function(b0){return _1.Updates(bZ(b0));},bV.Attrs),d.TreeReduce(y.Const(),y.Map2Unit,bY)),bX.v),bu.get(bV.Els,0),bX);};bb.New=function(bV,bW,bX){var bY,bZ;bY=$.CreateElemNode(bV,bW,bX.docNode);bZ=A.Create(bX.updates);return new bb.New$1({$:1,$0:bY},y.Map2Unit(_1.Updates(bY.Attr),bZ.v),bV,bZ);};bb.New$1=bC.Ctor(function(bV,bW,bX,bY){ba.New.call(this,bV,bW);this.docNode$1=bV;this.updates$1=bW;this.elt=bX;this.rvUpdates=bY;},bb);bc=Y.EltUpdater=bC.Class({RemoveAllUpdated:function(){this.treeNode.Holes=this.origHoles;this.holeUpdates.Set([]);},RemoveUpdated:function(bV){var bW,bX;function bY(bZ){return bZ!==bX;}bW=bV.docNode;bW!=null&&bW.$==1?(bX=bW.$0.ElKey,this.treeNode.Holes=bu.filter(function(bZ){return bZ.ElKey!==bX;},this.treeNode.Holes),this.holeUpdates.Set(bu.filter(function(bZ){return bY(bZ[0]);},this.holeUpdates.Get()))):bI.FailWith("DocUpdater.RemoveUpdated expects a single element node");},AddUpdated:function(bV){var bW,bX,bY;bW=bV.docNode;bW!=null&&bW.$==1?(bX=bW.$0,this.treeNode.Holes=this.treeNode.Holes.concat([bX]),bY=this.holeUpdates.Get(),bY.push([bX.ElKey,bV.updates]),this.holeUpdates.Set(bY)):bI.FailWith("DocUpdater.AddUpdated expects a single element node");},ClearHoles:function(){this.origHoles=[];this.treeNode.Holes=[];this.holeUpdates.Set([]);},AddHole:function(bV){this.origHoles.push(bV);this.treeNode.Holes=this.treeNode.Holes.concat([bV]);}},bb,bc);bc.New=bC.Ctor(function(bV,bW,bX,bY,bZ){var b0,b1,b2,b3;function b4(b5){return b5[1];}bb.New$1.call(this,{$:6,$0:bV},y.Map2Unit(bW,(b0=bZ.get_View(),y.BindInner((b1=function(b5){return bu.map(b4,b5);},(b2=(b3=y.Const(),function(b5){return d.TreeReduce(b3,y.Map2Unit,b5);}),function(b5){return b2(b1(b5));})),b0))),bX,bY);this.treeNode=bV;this.holeUpdates=bZ;this.origHoles=this.treeNode.Holes;},bc);bd.$cctor=function(){bd.$cctor=a.ignore;bd.BatchUpdatesEnabled=true;bd.LoadedTemplates=new bL.New$5();bd.LocalTemplatesLoaded=false;bd.TextHoleRE="\\${([^}]+)}";};be=c.Flow=bC.Class({get_Render:function(){return this.render;}},k,be);be.New=bC.Ctor(function(bV){be.New$1.call(this,function(bW){return function(bX){return x.Set(bW,bV(bX));};});},be);be.New$1=bC.Ctor(function(bV){this.render=bV;},be);be.get_Do=function(){return new bf.New();};be.Static=function(bV){return new be.New$1(function(bW){return function(bX){x.Set(bW,bV);return bX();};});};be.Define=function(bV){return new be.New(function(bW){return bV(function(bX){bW(bX);});});};be.Embed=function(bV){var bW;bW=x.Create$1(ba.Empty());((bV.get_Render())(bW))(a.ignore);return ba.EmbedView(bW.get_View());};be.Return=function(bV){return new be.New$1(function(){return function(bW){return bW(bV);};});};be.Bind=function(bV,bW){return new be.New$1(function(bX){return function(bY){return((bV.get_Render())(bX))(function(bZ){((bW(bZ).get_Render())(bX))(bY);});};});};be.Map=function(bV,bW){return new be.New$1(function(bX){return function(bY){return((bW.get_Render())(bX))(function(bZ){bY(bV(bZ));});};});};bf=c.FlowBuilder=bC.Class({ReturnFrom:a.id,Return:function(bV){return be.Return(bV);},Bind:function(bV,bW){return be.Bind(bV,bW);}},k,bf);bf.New=bC.Ctor(function(){},bf);bh=bg.attr=bC.Class({},k,bh);bh.New=bC.Ctor(function(){},bh);bi.InstallHash=function(bV,bW){var bX;function bY(b1){return bS.Parse(bW,bT.FromHash(b1,{$:1,$0:true}));}function bZ(){var b1,b2;b1=a.location.hash;b2=bY(b1);return b2==null?((function(b3){return function(b4){return b3("Failed to parse route: "+bU.toSafe(b4));};}(function(b3){bE.log(b3);}))(b1),bV):b2.$0;}function b0(b1){if(!bD.Equals(bX.Get(),b1))bX.Set(b1);}bX=x.Create$1(bZ());a.onpopstate=function(){return b0(bZ());};a.onhashchange=function(){return b0(bZ());};bP(a.document.body).click(function(b1){var b2,b3,b4,b5;b2=bP(b1.target).closest("a").toArray();return!bD.Equals(b2,null)&&b2.length===1?(b3=bu.get(b2,0),b3.localName==="a"?(b4=b3.getAttribute("href"),!(b4==null)&&bw.StartsWith(b4,"#")?(b5=bY(b4),b5==null?null:(b0(b5.$0),b1.preventDefault())):null):null):null;});y.Sink(function(b1){var b2;if(!bD.Equals(b1,bZ())){b2=bS.HashLink(bW,b1);a.history.pushState(null,null,b2);}},bX.get_View());return bX;};bi.Install=function(bV,bW){var bX;function bY(b1){return bS.Parse(bW,b1);}function bZ(){var b1,b2,b3;b1=a.location;b2=bT.FromUrl(b1.pathname+b1.search,null);b3=bY(b2);return b3==null?((function(b4){return function(b5){return b4("Failed to parse route: "+bU.toSafe(b5));};}(function(b4){bE.log(b4);}))(b2.ToLink()),bV):b3.$0;}function b0(b1){if(!bD.Equals(bX.Get(),b1))bX.Set(b1);}bX=x.Create$1(bZ());a.onpopstate=function(){return b0(bZ());};bP(a.document.body).click(function(b1){var b2,b3,b4,b5;b2=bP(b1.target).closest("a").toArray();return!bD.Equals(b2,null)&&b2.length===1?(b3=bu.get(b2,0),b3.localName==="a"?(b4=b3.getAttribute("href"),!(b4==null)?(b5=bY(bT.FromUrl(b4,null)),b5==null?null:(b0(b5.$0),b1.preventDefault())):null):null):null;});y.Sink(function(b1){var b2;if(!bD.Equals(b1,bZ())){b2=bS.Link(bW,b1);a.history.pushState(null,null,b2);}},bX.get_View());return bX;};bj.Append=function(bV,bW){return{$:0,$0:p.Append(bV.$0,bW.$0),$1:bG.FoldBack(function(bX,bY,bZ){return bZ.Add(bX,bY);},bV.$1,bW.$1)};};bj.FromList=function(bV,bW){return{$:0,$0:p.FromArray(bu.ofList(bV)),$1:bW};};bj.ToList=function(bV){return[bt.ofArray(p.ToArray(bV.$0)),bV.$1];};bj.SameHash=function(bV,bW){return bj.NoHash(bV)===bj.NoHash(bW);};bj.MakeHash=function(bV){var bW,bX;bW=bV.$1;bX=bw.concat("/",bu.map(function(bY){return a.encodeURIComponent(bY);},p.ToArray(bV.$0)));return bW.get_IsEmpty()?bX:bX+"?"+bw.concat("&",bA.map(function(bY){var bZ;bZ=bI.KeyValue(bY);return a.encodeURIComponent(bZ[0])+"="+a.encodeURIComponent(bZ[1]);},bW));};bj.ParseHash=function(bV){var bW,bX,bY,bZ;bW=bj.NoHash(bV);bX=(bY=bW.indexOf("?"),bY===-1?[bW,""]:[bQ.string(bW,null,{$:1,$0:bY-1}),bQ.string(bW,{$:1,$0:bY+1},null)]);bZ=bX[0];return{$:0,$0:p.FromArray(bZ===""?[]:bu.map(function(b0){return a.decodeURIComponent(b0);},bw.SplitChars(bZ,["/"],0))),$1:bG.OfArray(bu.map(function(b0){var b1;b1=b0.indexOf("=");return b1===-1?[a.decodeURIComponent(b0),""]:[a.decodeURIComponent(bQ.string(b0,null,{$:1,$0:b1-1})),a.decodeURIComponent(bQ.string(b0,{$:1,$0:b1+1},null))];},bw.SplitChars(bX[1],["&"],0)))};};bj.NoHash=function(bV){return bw.StartsWith(bV,"#")?bV.substring(1):bV;};bk.DoLink=function(bV,bW){var bX;bX=bV.Ser(bW);return bj.FromList(bX[0],bX[1]);};bk.DoRoute=function(bV,bW){return bV.Des(bj.ToList(bW));};bk.InstallMap=function(bV){var bW;function bX(b1,b2){return bD.Equals(bV.Ser(b1),bV.Ser(b2));}function bY(){return bV.Des(bj.ToList(bj.ParseHash(a.location.hash)));}function bZ(b1){if(!bX(bW.Get(),b1))bW.Set(b1);}function b0(b1){return bZ(bY());}bW=x.Create$1(bY());a.onpopstate=b0;a.onhashchange=b0;y.Sink(function(b1){var b2,b3;b2=bj.MakeHash((b3=bV.Ser(b1),bj.FromList(b3[0],b3[1])));!bj.SameHash(a.location.hash,b2)?a.location.replace("#"+b2):void 0;},bW.get_View());return bW;};bl.Install=function(bV){return bk.InstallMap(bV);};bl.Create=function(bV,bW){function bX(bY){return bY[0];}return{Des:function(bY){return bW(bX(bY));},Ser:function(bY){return[bV(bY),new bH.New([])];}};};bl.CreateWithQuery=function(bV,bW){return{Des:bW,Ser:bV};};bn.New=function(bV,bW){return{Active:bV,PosV:bW};};bo.New=function(bV,bW,bX,bY){return{Active:bV,Left:bW,Middle:bX,Right:bY};};bp.get_MousePressed=function(){bm.ActivateButtonListener();return y.Apply(y.Apply(y.Apply(y.Const(bC.Curried3(function(bV,bW,bX){return bV||bW||bX;})),bm.MouseBtnSt$1().Left.get_View()),bm.MouseBtnSt$1().Middle.get_View()),bm.MouseBtnSt$1().Right.get_View());};bp.get_RightPressed=function(){bm.ActivateButtonListener();return bm.MouseBtnSt$1().Right.get_View();};bp.get_MiddlePressed=function(){bm.ActivateButtonListener();return bm.MouseBtnSt$1().Middle.get_View();};bp.get_LeftPressed=function(){bm.ActivateButtonListener();return bm.MouseBtnSt$1().Left.get_View();};bp.get_Position=function(){!bm.MousePosSt$1().Active?(a.document.addEventListener("mousemove",function(bV){x.Set(bm.MousePosSt$1().PosV,[bV.clientX,bV.clientY]);},false),bm.MousePosSt$1().Active=true):void 0;return bm.MousePosSt$1().PosV.get_View();};bq.New=function(bV,bW,bX){return{KeysPressed:bV,KeyListenerActive:bW,LastPressed:bX};};br.IsPressed=function(bV){function bW(bX){return bX===bV;}bm.ActivateKeyListener();return y.Map(function(bX){return bt.exists(bW,bX);},bm.KeyListenerState().KeysPressed.get_View());};br.get_LastPressed=function(){bm.ActivateKeyListener();return bm.KeyListenerState().LastPressed.get_View();};br.get_KeysPressed=function(){bm.ActivateKeyListener();return bm.KeyListenerState().KeysPressed.get_View();};bm.ActivateKeyListener=function(){bs.$cctor();return bs.ActivateKeyListener;};bm.KeyListenerState=function(){bs.$cctor();return bs.KeyListenerState;};bm.ActivateButtonListener=function(){bs.$cctor();return bs.ActivateButtonListener;};bm.MouseBtnSt$1=function(){bs.$cctor();return bs.MouseBtnSt;};bm.MousePosSt$1=function(){bs.$cctor();return bs.MousePosSt;};bs.$cctor=function(){bs.$cctor=a.ignore;function bV(bW,bX){var bY;bY=bW.button;return bY===0?x.Set(bm.MouseBtnSt$1().Left,bX):bY===1?x.Set(bm.MouseBtnSt$1().Middle,bX):bY===2?x.Set(bm.MouseBtnSt$1().Right,bX):null;}bs.MousePosSt=bn.New(false,x.Create$1([0,0]));bs.MouseBtnSt=bo.New(false,x.Create$1(false),x.Create$1(false),x.Create$1(false));bs.ActivateButtonListener=!bm.MouseBtnSt$1().Active?(bm.MouseBtnSt$1().Active=true,a.document.addEventListener("mousedown",function(bW){return bV(bW,true);},false),a.document.addEventListener("mouseup",function(bW){return bV(bW,false);},false)):null;bs.KeyListenerState=bq.New(x.Create$1(bt.T.Empty),false,x.Create$1(-1));bs.ActivateKeyListener=!bm.KeyListenerState().KeyListenerActive?(bP(a.document).keydown(function(bW){var bX,bY;bX=bW.which;x.Set(bm.KeyListenerState().LastPressed,bX);bY=bm.KeyListenerState().KeysPressed.Get();return!bt.exists(function(bZ){return bZ===bX;},bY)?bm.KeyListenerState().KeysPressed.Set(bt.append(bY,bt.ofArray([bX]))):null;}),void bP(a.document).keyup(function(bW){var bX;function bY(bZ){return bZ!==bX;}bX=bW.which;return x.Update(bm.KeyListenerState().KeysPressed,function(bZ){return bt.filter(bY,bZ);});})):null;};}());
